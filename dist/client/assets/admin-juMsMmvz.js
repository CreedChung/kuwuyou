import{c as H,j as e,L as is,a as $,w as ls,x as ds,r,g as Ze,l as B,m as _e,k as E,d as Ve,i as us,u as J,V as ms,y as ps,q as Xe,n as xs,D as hs,z as fs,e as gs}from"./main--f0sO-hz.js";import{B as D}from"./button-BNUdYx8Q.js";import{A as vs}from"./arrow-left-CIBegNe1.js";import{S as Je,U as ce,u as Qe}from"./index-Cb-BIaVj.js";import{S as et,R as tt,M as st,C as js,G as ys,u as Ns,a as nt,c as rt,b as Ss,A as ws,d as bs,e as Cs,f as ot,g as Is,T as Ts,h as Ps,i as Es}from"./separator-xzySayxy.js";import{C as Z,a as pe,b as xe,c as ve,d as X,I as Re}from"./index-CrzuKdR7.js";import{B as ie}from"./badge-CHSACegF.js";import{L as le}from"./label-BFd5GmZs.js";import{u as _s}from"./index-DXfdyvh0.js";import{h as Rs,u as ks,R as As,F as Ms,D as at,a as ct,b as it,c as lt,d as dt,e as Ds,L as $e,P as Ls}from"./ProtectedRoute-CTX_1QGf.js";import{u as He}from"./index-CtyBIE80.js";import{C as Os}from"./check--sExKTx5.js";import{T as Bs,a as Us,b as We}from"./tabs-e6inYRzY.js";import{U as ze}from"./user-DhuRz-TF.js";import{M as Vs,E as $s}from"./mail-DUndaRIj.js";import{S as Hs}from"./react-icons.esm-DE5O5_Xe.js";import"./index-BjI2Q4Tk.js";const Fs=[["path",{d:"M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2",key:"169zse"}]],ut=H("activity",Fs);const Ws=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]],ke=H("calendar",Ws);const zs=[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]],mt=H("chart-column",zs);const Gs=[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]],Ks=H("circle-check-big",Gs);const qs=[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]],Ys=H("download",qs);const Zs=[["path",{d:"M10 20a1 1 0 0 0 .553.895l2 1A1 1 0 0 0 14 21v-7a2 2 0 0 1 .517-1.341L21.74 4.67A1 1 0 0 0 21 3H3a1 1 0 0 0-.742 1.67l7.225 7.989A2 2 0 0 1 10 14z",key:"sc7q7i"}]],Xs=H("funnel",Zs);const Js=[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]],Qs=H("square-pen",Js);const en=[["path",{d:"M16 17h6v-6",key:"t6n2it"}],["path",{d:"m22 17-8.5-8.5-5 5L2 7",key:"x473p"}]],Ge=H("trending-down",en);const tn=[["path",{d:"M16 7h6v6",key:"box55l"}],["path",{d:"m22 7-8.5 8.5-5-5L2 17",key:"1t1m79"}]],Ae=H("trending-up",tn);const sn=[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]],Ke=H("triangle-alert",sn);const nn=[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]],pt=H("upload",nn),rn=[{id:"overview",label:"概览",icon:mt},{id:"users",label:"用户管理",icon:ce},{id:"analytics",label:"数据分析",icon:ut},{id:"system",label:"系统设置",icon:et}];function on({activeSection:t,onSectionChange:n}){return e.jsxs("div",{className:"w-64 border-r border-border/40 bg-muted/30 flex flex-col",children:[e.jsx("div",{className:"p-4 border-b border-border/40",children:e.jsx(is,{href:"/",children:e.jsxs(D,{variant:"ghost",size:"sm",className:"w-full justify-start gap-2 hover:bg-muted",children:[e.jsx(vs,{className:"h-4 w-4"}),e.jsx("span",{children:"返回"})]})})}),e.jsxs("div",{className:"px-4 py-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Je,{className:"h-5 w-5 text-primary"}),e.jsx("h1",{className:"text-xl font-semibold",children:"管理员面板"})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"系统管理与监控"})]}),e.jsx("nav",{className:"flex-1 px-2 pb-4 space-y-1 overflow-y-auto",children:rn.map(s=>{const c=s.icon,o=t===s.id;return e.jsxs("button",{type:"button",onClick:()=>n(s.id),className:$("w-full flex items-center gap-3 px-3 py-2.5 rounded-lg text-sm font-medium transition-colors",o?"bg-muted text-foreground":"text-muted-foreground hover:bg-muted/50 hover:text-foreground"),children:[e.jsx(c,{className:"h-4 w-4 shrink-0"}),e.jsx("span",{children:s.label})]},s.id)})})]})}const an={totalUsers:0,activeUsers:0,totalRevenue:0,totalMessages:0,userGrowth:0,activeGrowth:0,revenueGrowth:0,messageGrowth:0},cn={server:"normal",database:"normal",api:"normal",uptime:"0天 0小时",dbResponseTime:"0ms"},xt=ls()(ds(t=>({adminUser:null,isAdmin:!1,systemStats:an,systemStatus:cn,setAdminUser:n=>t({adminUser:n,isAdmin:n!==null}),updateSystemStats:n=>t(s=>({systemStats:{...s.systemStats,...n}})),updateSystemStatus:n=>t(s=>({systemStatus:{...s.systemStatus,...n}})),logout:()=>t({adminUser:null,isAdmin:!1})}),{name:"admin-storage",partialize:t=>({adminUser:t.adminUser,isAdmin:t.isAdmin})}));function ln(){const{systemStats:t}=xt(),[n,s]=r.useState(null),[c,o]=r.useState(!1),d=async()=>{o(!0);try{const i=await(await fetch("/api/admin/analytics")).json();i.success&&s(i.data)}catch(a){console.error("获取分析数据失败:",a)}finally{o(!1)}};return r.useEffect(()=>{d()},[]),e.jsxs("div",{className:"space-y-6 animate-in fade-in-50 duration-300",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold mb-2",children:"数据分析"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"查看详细的数据统计和分析报告"})]}),e.jsxs(D,{variant:"outline",size:"sm",onClick:d,disabled:c,className:"gap-2",children:[e.jsx(tt,{className:`h-4 w-4 ${c?"animate-spin":""}`}),"刷新"]})]}),e.jsxs(Z,{children:[e.jsxs(pe,{children:[e.jsxs(xe,{className:"text-lg flex items-center gap-2",children:[e.jsx(mt,{className:"h-5 w-5"}),"使用统计"]}),e.jsx(ve,{children:"过去30天的使用数据"})]}),e.jsx(X,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 rounded-lg bg-muted/50",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(st,{className:"h-5 w-5 text-primary"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"总消息数"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"所有用户消息"})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-2xl font-bold",children:n?.totalMessages.toLocaleString()||t.totalMessages.toLocaleString()}),e.jsxs("p",{className:"text-xs text-green-500 flex items-center gap-1 justify-end",children:[e.jsx(Ae,{className:"h-3 w-3"}),"+",t.messageGrowth,"%"]})]})]}),e.jsxs("div",{className:"flex items-center justify-between p-4 rounded-lg bg-muted/50",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ce,{className:"h-5 w-5 text-primary"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"活跃用户"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"30天内活跃"})]})]}),e.jsx("p",{className:"text-2xl font-bold",children:n?.activeUsers.toLocaleString()||t.activeUsers.toLocaleString()})]}),e.jsxs("div",{className:"flex items-center justify-between p-4 rounded-lg bg-muted/50",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(js,{className:"h-5 w-5 text-primary"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"平均响应时间"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"AI 响应速度"})]})]}),e.jsxs("p",{className:"text-2xl font-bold",children:[n?.avgResponseTime||"1.2","s"]})]}),e.jsxs("div",{className:"flex items-center justify-between p-4 rounded-lg bg-muted/50",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ys,{className:"h-5 w-5 text-primary"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"API 调用次数"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"总请求数"})]})]}),e.jsx("p",{className:"text-2xl font-bold",children:n?.apiCalls.toLocaleString()||"0"})]})]})})]}),n?.dailyStats&&e.jsxs(Z,{children:[e.jsxs(pe,{children:[e.jsxs(xe,{className:"text-lg flex items-center gap-2",children:[e.jsx(ke,{className:"h-5 w-5"}),"每日统计"]}),e.jsx(ve,{children:"最近7天的活动趋势"})]}),e.jsx(X,{children:e.jsx("div",{className:"space-y-2",children:n.dailyStats.slice(-7).map(a=>e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg bg-muted/50",children:[e.jsx("span",{className:"text-sm font-medium",children:a.date}),e.jsxs("div",{className:"flex items-center gap-4 text-sm",children:[e.jsxs("span",{className:"text-muted-foreground",children:["消息: ",e.jsx("span",{className:"font-medium text-foreground",children:a.messages})]}),e.jsxs("span",{className:"text-muted-foreground",children:["用户: ",e.jsx("span",{className:"font-medium text-foreground",children:a.users})]})]})]},a.date))})})]})]})}function qe(){const{systemStats:t,systemStatus:n,updateSystemStats:s,updateSystemStatus:c}=xt(),[o,d]=r.useState(!1),a=async()=>{d(!0);try{const m=await(await fetch("/api/admin/stats")).json();m.success&&s(m.data)}catch(u){console.error("获取统计数据失败:",u)}finally{d(!1)}},i=async()=>{try{const m=await(await fetch("/api/admin/system")).json();m.success&&c(m.data)}catch(u){console.error("获取系统状态失败:",u)}};r.useEffect(()=>{a(),i();const u=setInterval(()=>{a(),i()},3e4);return()=>clearInterval(u)},[]);const l=u=>{switch(u){case"normal":return e.jsxs(ie,{className:"gap-1.5 bg-green-500/10 text-green-500 border-green-500/20",children:[e.jsx(Ks,{className:"h-3 w-3"}),"正常"]});case"warning":return e.jsxs(ie,{className:"gap-1.5 bg-yellow-500/10 text-yellow-500 border-yellow-500/20",children:[e.jsx(Ke,{className:"h-3 w-3"}),"警告"]});case"error":return e.jsxs(ie,{className:"gap-1.5 bg-red-500/10 text-red-500 border-red-500/20",children:[e.jsx(Ke,{className:"h-3 w-3"}),"错误"]})}};return e.jsxs("div",{className:"space-y-6 animate-in fade-in-50 duration-300",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold mb-2",children:"系统概览"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"查看系统整体运行状态和关键指标"})]}),e.jsxs(D,{variant:"outline",size:"sm",onClick:a,disabled:o,className:"gap-2",children:[e.jsx(tt,{className:`h-4 w-4 ${o?"animate-spin":""}`}),"刷新"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[e.jsx(Z,{children:e.jsxs(X,{className:"pt-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(ce,{className:"h-5 w-5 text-muted-foreground"}),t.userGrowth>=0?e.jsx(Ae,{className:"h-4 w-4 text-green-500"}):e.jsx(Ge,{className:"h-4 w-4 text-red-500"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-2xl font-bold",children:t.totalUsers.toLocaleString()}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"总用户数"}),e.jsxs("p",{className:`text-xs font-medium ${t.userGrowth>=0?"text-green-500":"text-red-500"}`,children:[t.userGrowth>=0?"+":"",t.userGrowth,"%"]})]})]})}),e.jsx(Z,{children:e.jsxs(X,{className:"pt-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(st,{className:"h-5 w-5 text-muted-foreground"}),t.messageGrowth>=0?e.jsx(Ae,{className:"h-4 w-4 text-green-500"}):e.jsx(Ge,{className:"h-4 w-4 text-red-500"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-2xl font-bold",children:t.totalMessages.toLocaleString()}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"消息总数"}),e.jsxs("p",{className:`text-xs font-medium ${t.messageGrowth>=0?"text-green-500":"text-red-500"}`,children:[t.messageGrowth>=0?"+":"",t.messageGrowth,"%"]})]})]})})]}),e.jsxs(Z,{children:[e.jsxs(pe,{children:[e.jsxs(xe,{className:"text-lg flex items-center gap-2",children:[e.jsx(ut,{className:"h-5 w-5"}),"系统状态"]}),e.jsx(ve,{children:"实时系统运行状态"})]}),e.jsx(X,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"p-4 rounded-lg bg-muted/50",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"服务器状态"}),l(n.server)]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["运行时间: ",n.uptime]})]}),e.jsxs("div",{className:"p-4 rounded-lg bg-muted/50",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"数据库"}),l(n.database)]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["响应时间: ",n.dbResponseTime]})]}),e.jsxs("div",{className:"p-4 rounded-lg bg-muted/50",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"API 服务"}),l(n.api)]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:n.api==="normal"?"运行正常":"请求延迟较高"})]})]})})]})]})}function dn(t,n=[]){let s=[];function c(d,a){const i=r.createContext(a),l=s.length;s=[...s,a];const u=x=>{const{scope:f,children:y,...g}=x,p=f?.[t]?.[l]||i,v=r.useMemo(()=>g,Object.values(g));return e.jsx(p.Provider,{value:v,children:y})};u.displayName=d+"Provider";function m(x,f){const y=f?.[t]?.[l]||i,g=r.useContext(y);if(g)return g;if(a!==void 0)return a;throw new Error(`\`${x}\` must be used within \`${d}\``)}return[u,m]}const o=()=>{const d=s.map(a=>r.createContext(a));return function(i){const l=i?.[t]||d;return r.useMemo(()=>({[`__scope${t}`]:{...i,[t]:l}}),[i,l])}};return o.scopeName=t,[c,un(o,...n)]}function un(...t){const n=t[0];if(t.length===1)return n;const s=()=>{const c=t.map(o=>({useScope:o(),scopeName:o.scopeName}));return function(d){const a=c.reduce((i,{useScope:l,scopeName:u})=>{const x=l(d)[`__scope${u}`];return{...i,...x}},{});return r.useMemo(()=>({[`__scope${n.scopeName}`]:a}),[a])}};return s.scopeName=n.scopeName,s}function mn(t){const n=pn(t),s=r.forwardRef((c,o)=>{const{children:d,...a}=c,i=r.Children.toArray(d),l=i.find(hn);if(l){const u=l.props.children,m=i.map(x=>x===l?r.Children.count(u)>1?r.Children.only(null):r.isValidElement(u)?u.props.children:null:x);return e.jsx(n,{...a,ref:o,children:r.isValidElement(u)?r.cloneElement(u,void 0,m):null})}return e.jsx(n,{...a,ref:o,children:d})});return s.displayName=`${t}.Slot`,s}function pn(t){const n=r.forwardRef((s,c)=>{const{children:o,...d}=s;if(r.isValidElement(o)){const a=gn(o),i=fn(d,o.props);return o.type!==r.Fragment&&(i.ref=c?Ze(c,a):a),r.cloneElement(o,i)}return r.Children.count(o)>1?r.Children.only(null):null});return n.displayName=`${t}.SlotClone`,n}var xn=Symbol("radix.slottable");function hn(t){return r.isValidElement(t)&&typeof t.type=="function"&&"__radixId"in t.type&&t.type.__radixId===xn}function fn(t,n){const s={...n};for(const c in n){const o=t[c],d=n[c];/^on[A-Z]/.test(c)?o&&d?s[c]=(...i)=>{const l=d(...i);return o(...i),l}:o&&(s[c]=o):c==="style"?s[c]={...o,...d}:c==="className"&&(s[c]=[o,d].filter(Boolean).join(" "))}return{...t,...s}}function gn(t){let n=Object.getOwnPropertyDescriptor(t.props,"ref")?.get,s=n&&"isReactWarning"in n&&n.isReactWarning;return s?t.ref:(n=Object.getOwnPropertyDescriptor(t,"ref")?.get,s=n&&"isReactWarning"in n&&n.isReactWarning,s?t.props.ref:t.props.ref||t.ref)}var vn=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],ht=vn.reduce((t,n)=>{const s=mn(`Primitive.${n}`),c=r.forwardRef((o,d)=>{const{asChild:a,...i}=o,l=a?s:n;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),e.jsx(l,{...i,ref:d})});return c.displayName=`Primitive.${n}`,{...t,[n]:c}},{}),ye="Switch",[jn]=dn(ye),[yn,Nn]=jn(ye),ft=r.forwardRef((t,n)=>{const{__scopeSwitch:s,name:c,checked:o,defaultChecked:d,required:a,disabled:i,value:l="on",onCheckedChange:u,form:m,...x}=t,[f,y]=r.useState(null),g=B(n,N=>y(N)),p=r.useRef(!1),v=f?m||!!f.closest("form"):!0,[w,h]=_e({prop:o,defaultProp:d??!1,onChange:u,caller:ye});return e.jsxs(yn,{scope:s,checked:w,disabled:i,children:[e.jsx(ht.button,{type:"button",role:"switch","aria-checked":w,"aria-required":a,"data-state":yt(w),"data-disabled":i?"":void 0,disabled:i,value:l,...x,ref:g,onClick:E(t.onClick,N=>{h(_=>!_),v&&(p.current=N.isPropagationStopped(),p.current||N.stopPropagation())})}),v&&e.jsx(jt,{control:f,bubbles:!p.current,name:c,value:l,checked:w,required:a,disabled:i,form:m,style:{transform:"translateX(-100%)"}})]})});ft.displayName=ye;var gt="SwitchThumb",vt=r.forwardRef((t,n)=>{const{__scopeSwitch:s,...c}=t,o=Nn(gt,s);return e.jsx(ht.span,{"data-state":yt(o.checked),"data-disabled":o.disabled?"":void 0,...c,ref:n})});vt.displayName=gt;var Sn="SwitchBubbleInput",jt=r.forwardRef(({__scopeSwitch:t,control:n,checked:s,bubbles:c=!0,...o},d)=>{const a=r.useRef(null),i=B(a,d),l=Qe(s),u=Ns(n);return r.useEffect(()=>{const m=a.current;if(!m)return;const x=window.HTMLInputElement.prototype,y=Object.getOwnPropertyDescriptor(x,"checked").set;if(l!==s&&y){const g=new Event("click",{bubbles:c});y.call(m,s),m.dispatchEvent(g)}},[l,s,c]),e.jsx("input",{type:"checkbox","aria-hidden":!0,defaultChecked:s,...o,tabIndex:-1,ref:i,style:{...o.style,...u,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});jt.displayName=Sn;function yt(t){return t?"checked":"unchecked"}var Nt=ft,wn=vt;const Me=r.forwardRef(({className:t,...n},s)=>e.jsx(Nt,{className:$("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-all duration-150 ease-in-out focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input active:scale-95",t),...n,ref:s,children:e.jsx(wn,{className:$("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0")})}));Me.displayName=Nt.displayName;function bn({autoBackup:t,onAutoBackupChange:n}){const s=r.useId(),c=r.useId(),[o,d]=r.useState(!0),[a,i]=r.useState(!1),{toast:l}=Ve(),u=async()=>{i(!0);try{const f=await(await fetch("/api/admin/system/backup",{method:"POST"})).json();f.success?l({title:"备份成功",description:f.message||"数据库已成功备份"}):l({title:"备份失败",description:f.error||"数据库备份失败",variant:"destructive"})}catch{l({title:"备份失败",description:"网络错误，请稍后重试",variant:"destructive"})}finally{i(!1)}},m=async(x,f)=>{try{const g=await(await fetch("/api/admin/system",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({setting:x,value:f})})).json();g.success&&l({title:"设置已更新",description:g.message})}catch(y){console.error("更新设置失败:",y)}};return e.jsxs("div",{className:"space-y-6 animate-in fade-in-50 duration-300",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold mb-2",children:"系统设置"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"配置系统参数和功能选项"})]}),e.jsxs(Z,{children:[e.jsxs(pe,{children:[e.jsxs(xe,{className:"text-lg flex items-center gap-2",children:[e.jsx(et,{className:"h-5 w-5"}),"系统配置"]}),e.jsx(ve,{children:"管理系统核心设置"})]}),e.jsxs(X,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 rounded-lg bg-muted/50",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(le,{htmlFor:s,className:"text-sm font-medium",children:"自动备份"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"每天自动备份数据库"})]}),e.jsx(Me,{id:s,checked:t,onCheckedChange:x=>{n(x),m("autoBackup",x)}})]}),e.jsxs("div",{className:"flex items-center justify-between p-4 rounded-lg bg-muted/50",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(le,{htmlFor:c,className:"text-sm font-medium",children:"自动更新"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"自动检查并安装系统更新"})]}),e.jsx(Me,{id:c,checked:o,onCheckedChange:x=>{d(x),m("autoUpdate",x)}})]}),e.jsx(nt,{}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(le,{className:"text-sm font-medium",children:"数据库操作"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs(D,{variant:"outline",className:"flex-1 gap-2",onClick:u,disabled:a,children:[e.jsx(Ys,{className:"h-4 w-4"}),a?"备份中...":"备份数据库"]}),e.jsxs(D,{variant:"outline",className:"flex-1 gap-2",children:[e.jsx(pt,{className:"h-4 w-4"}),"恢复数据库"]})]})]})]})]})]})}function Ye(t,[n,s]){return Math.min(s,Math.max(n,t))}function Cn(t,n=[]){let s=[];function c(d,a){const i=r.createContext(a),l=s.length;s=[...s,a];const u=x=>{const{scope:f,children:y,...g}=x,p=f?.[t]?.[l]||i,v=r.useMemo(()=>g,Object.values(g));return e.jsx(p.Provider,{value:v,children:y})};u.displayName=d+"Provider";function m(x,f){const y=f?.[t]?.[l]||i,g=r.useContext(y);if(g)return g;if(a!==void 0)return a;throw new Error(`\`${x}\` must be used within \`${d}\``)}return[u,m]}const o=()=>{const d=s.map(a=>r.createContext(a));return function(i){const l=i?.[t]||d;return r.useMemo(()=>({[`__scope${t}`]:{...i,[t]:l}}),[i,l])}};return o.scopeName=t,[c,In(o,...n)]}function In(...t){const n=t[0];if(t.length===1)return n;const s=()=>{const c=t.map(o=>({useScope:o(),scopeName:o.scopeName}));return function(d){const a=c.reduce((i,{useScope:l,scopeName:u})=>{const x=l(d)[`__scope${u}`];return{...i,...x}},{});return r.useMemo(()=>({[`__scope${n.scopeName}`]:a}),[a])}};return s.scopeName=n.scopeName,s}function St(t){const n=Tn(t),s=r.forwardRef((c,o)=>{const{children:d,...a}=c,i=r.Children.toArray(d),l=i.find(En);if(l){const u=l.props.children,m=i.map(x=>x===l?r.Children.count(u)>1?r.Children.only(null):r.isValidElement(u)?u.props.children:null:x);return e.jsx(n,{...a,ref:o,children:r.isValidElement(u)?r.cloneElement(u,void 0,m):null})}return e.jsx(n,{...a,ref:o,children:d})});return s.displayName=`${t}.Slot`,s}function Tn(t){const n=r.forwardRef((s,c)=>{const{children:o,...d}=s;if(r.isValidElement(o)){const a=Rn(o),i=_n(d,o.props);return o.type!==r.Fragment&&(i.ref=c?Ze(c,a):a),r.cloneElement(o,i)}return r.Children.count(o)>1?r.Children.only(null):null});return n.displayName=`${t}.SlotClone`,n}var Pn=Symbol("radix.slottable");function En(t){return r.isValidElement(t)&&typeof t.type=="function"&&"__radixId"in t.type&&t.type.__radixId===Pn}function _n(t,n){const s={...n};for(const c in n){const o=t[c],d=n[c];/^on[A-Z]/.test(c)?o&&d?s[c]=(...i)=>{const l=d(...i);return o(...i),l}:o&&(s[c]=o):c==="style"?s[c]={...o,...d}:c==="className"&&(s[c]=[o,d].filter(Boolean).join(" "))}return{...t,...s}}function Rn(t){let n=Object.getOwnPropertyDescriptor(t.props,"ref")?.get,s=n&&"isReactWarning"in n&&n.isReactWarning;return s?t.ref:(n=Object.getOwnPropertyDescriptor(t,"ref")?.get,s=n&&"isReactWarning"in n&&n.isReactWarning,s?t.props.ref:t.props.ref||t.ref)}var kn=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],L=kn.reduce((t,n)=>{const s=St(`Primitive.${n}`),c=r.forwardRef((o,d)=>{const{asChild:a,...i}=o,l=a?s:n;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),e.jsx(l,{...i,ref:d})});return c.displayName=`Primitive.${n}`,{...t,[n]:c}},{}),An=[" ","Enter","ArrowUp","ArrowDown"],Mn=[" ","Enter"],re="Select",[Ne,Se,Dn]=us(re),[de]=Cn(re,[Dn,rt]),we=rt(),[Ln,Q]=de(re),[On,Bn]=de(re),wt=t=>{const{__scopeSelect:n,children:s,open:c,defaultOpen:o,onOpenChange:d,value:a,defaultValue:i,onValueChange:l,dir:u,name:m,autoComplete:x,disabled:f,required:y,form:g}=t,p=we(n),[v,w]=r.useState(null),[h,N]=r.useState(null),[_,k]=r.useState(!1),te=_s(u),[R,O]=_e({prop:c,defaultProp:o??!1,onChange:d,caller:re}),[S,U]=_e({prop:a,defaultProp:i,onChange:l,caller:re}),I=r.useRef(null),W=v?g||!!v.closest("form"):!0,[q,z]=r.useState(new Set),G=Array.from(q).map(A=>A.props.value).join(";");return e.jsx(Ss,{...p,children:e.jsxs(Ln,{required:y,scope:n,trigger:v,onTriggerChange:w,valueNode:h,onValueNodeChange:N,valueNodeHasChildren:_,onValueNodeHasChildrenChange:k,contentId:He(),value:S,onValueChange:U,open:R,onOpenChange:O,dir:te,triggerPointerDownPosRef:I,disabled:f,children:[e.jsx(Ne.Provider,{scope:n,children:e.jsx(On,{scope:t.__scopeSelect,onNativeOptionAdd:r.useCallback(A=>{z(F=>new Set(F).add(A))},[]),onNativeOptionRemove:r.useCallback(A=>{z(F=>{const K=new Set(F);return K.delete(A),K})},[]),children:s})}),W?e.jsxs(Kt,{"aria-hidden":!0,required:y,tabIndex:-1,name:m,autoComplete:x,value:S,onChange:A=>U(A.target.value),disabled:f,form:g,children:[S===void 0?e.jsx("option",{value:""}):null,Array.from(q)]},G):null]})})};wt.displayName=re;var bt="SelectTrigger",Ct=r.forwardRef((t,n)=>{const{__scopeSelect:s,disabled:c=!1,...o}=t,d=we(s),a=Q(bt,s),i=a.disabled||c,l=B(n,a.onTriggerChange),u=Se(s),m=r.useRef("touch"),[x,f,y]=Yt(p=>{const v=u().filter(N=>!N.disabled),w=v.find(N=>N.value===a.value),h=Zt(v,p,w);h!==void 0&&a.onValueChange(h.value)}),g=p=>{i||(a.onOpenChange(!0),y()),p&&(a.triggerPointerDownPosRef.current={x:Math.round(p.pageX),y:Math.round(p.pageY)})};return e.jsx(ws,{asChild:!0,...d,children:e.jsx(L.button,{type:"button",role:"combobox","aria-controls":a.contentId,"aria-expanded":a.open,"aria-required":a.required,"aria-autocomplete":"none",dir:a.dir,"data-state":a.open?"open":"closed",disabled:i,"data-disabled":i?"":void 0,"data-placeholder":qt(a.value)?"":void 0,...o,ref:l,onClick:E(o.onClick,p=>{p.currentTarget.focus(),m.current!=="mouse"&&g(p)}),onPointerDown:E(o.onPointerDown,p=>{m.current=p.pointerType;const v=p.target;v.hasPointerCapture(p.pointerId)&&v.releasePointerCapture(p.pointerId),p.button===0&&p.ctrlKey===!1&&p.pointerType==="mouse"&&(g(p),p.preventDefault())}),onKeyDown:E(o.onKeyDown,p=>{const v=x.current!=="";!(p.ctrlKey||p.altKey||p.metaKey)&&p.key.length===1&&f(p.key),!(v&&p.key===" ")&&An.includes(p.key)&&(g(),p.preventDefault())})})})});Ct.displayName=bt;var It="SelectValue",Tt=r.forwardRef((t,n)=>{const{__scopeSelect:s,className:c,style:o,children:d,placeholder:a="",...i}=t,l=Q(It,s),{onValueNodeHasChildrenChange:u}=l,m=d!==void 0,x=B(n,l.onValueNodeChange);return J(()=>{u(m)},[u,m]),e.jsx(L.span,{...i,ref:x,style:{pointerEvents:"none"},children:qt(l.value)?e.jsx(e.Fragment,{children:a}):d})});Tt.displayName=It;var Un="SelectIcon",Pt=r.forwardRef((t,n)=>{const{__scopeSelect:s,children:c,...o}=t;return e.jsx(L.span,{"aria-hidden":!0,...o,ref:n,children:c||"▼"})});Pt.displayName=Un;var Vn="SelectPortal",Et=t=>e.jsx(ps,{asChild:!0,...t});Et.displayName=Vn;var oe="SelectContent",_t=r.forwardRef((t,n)=>{const s=Q(oe,t.__scopeSelect),[c,o]=r.useState();if(J(()=>{o(new DocumentFragment)},[]),!s.open){const d=c;return d?Xe.createPortal(e.jsx(Rt,{scope:t.__scopeSelect,children:e.jsx(Ne.Slot,{scope:t.__scopeSelect,children:e.jsx("div",{children:t.children})})}),d):null}return e.jsx(kt,{...t,ref:n})});_t.displayName=oe;var V=10,[Rt,ee]=de(oe),$n="SelectContentImpl",Hn=St("SelectContent.RemoveScroll"),kt=r.forwardRef((t,n)=>{const{__scopeSelect:s,position:c="item-aligned",onCloseAutoFocus:o,onEscapeKeyDown:d,onPointerDownOutside:a,side:i,sideOffset:l,align:u,alignOffset:m,arrowPadding:x,collisionBoundary:f,collisionPadding:y,sticky:g,hideWhenDetached:p,avoidCollisions:v,...w}=t,h=Q(oe,s),[N,_]=r.useState(null),[k,te]=r.useState(null),R=B(n,j=>_(j)),[O,S]=r.useState(null),[U,I]=r.useState(null),W=Se(s),[q,z]=r.useState(!1),G=r.useRef(!1);r.useEffect(()=>{if(N)return Rs(N)},[N]),ks();const A=r.useCallback(j=>{const[T,...M]=W().map(P=>P.ref.current),[b]=M.slice(-1),C=document.activeElement;for(const P of j)if(P===C||(P?.scrollIntoView({block:"nearest"}),P===T&&k&&(k.scrollTop=0),P===b&&k&&(k.scrollTop=k.scrollHeight),P?.focus(),document.activeElement!==C))return},[W,k]),F=r.useCallback(()=>A([O,N]),[A,O,N]);r.useEffect(()=>{q&&F()},[q,F]);const{onOpenChange:K,triggerPointerDownPosRef:Y}=h;r.useEffect(()=>{if(N){let j={x:0,y:0};const T=b=>{j={x:Math.abs(Math.round(b.pageX)-(Y.current?.x??0)),y:Math.abs(Math.round(b.pageY)-(Y.current?.y??0))}},M=b=>{j.x<=10&&j.y<=10?b.preventDefault():N.contains(b.target)||K(!1),document.removeEventListener("pointermove",T),Y.current=null};return Y.current!==null&&(document.addEventListener("pointermove",T),document.addEventListener("pointerup",M,{capture:!0,once:!0})),()=>{document.removeEventListener("pointermove",T),document.removeEventListener("pointerup",M,{capture:!0})}}},[N,K,Y]),r.useEffect(()=>{const j=()=>K(!1);return window.addEventListener("blur",j),window.addEventListener("resize",j),()=>{window.removeEventListener("blur",j),window.removeEventListener("resize",j)}},[K]);const[be,he]=Yt(j=>{const T=W().filter(C=>!C.disabled),M=T.find(C=>C.ref.current===document.activeElement),b=Zt(T,j,M);b&&setTimeout(()=>b.ref.current.focus())}),Ce=r.useCallback((j,T,M)=>{const b=!G.current&&!M;(h.value!==void 0&&h.value===T||b)&&(S(j),b&&(G.current=!0))},[h.value]),Ie=r.useCallback(()=>N?.focus(),[N]),ae=r.useCallback((j,T,M)=>{const b=!G.current&&!M;(h.value!==void 0&&h.value===T||b)&&I(j)},[h.value]),fe=c==="popper"?De:At,ue=fe===De?{side:i,sideOffset:l,align:u,alignOffset:m,arrowPadding:x,collisionBoundary:f,collisionPadding:y,sticky:g,hideWhenDetached:p,avoidCollisions:v}:{};return e.jsx(Rt,{scope:s,content:N,viewport:k,onViewportChange:te,itemRefCallback:Ce,selectedItem:O,onItemLeave:Ie,itemTextRefCallback:ae,focusSelectedItem:F,selectedItemText:U,position:c,isPositioned:q,searchRef:be,children:e.jsx(As,{as:Hn,allowPinchZoom:!0,children:e.jsx(Ms,{asChild:!0,trapped:h.open,onMountAutoFocus:j=>{j.preventDefault()},onUnmountAutoFocus:E(o,j=>{h.trigger?.focus({preventScroll:!0}),j.preventDefault()}),children:e.jsx(hs,{asChild:!0,disableOutsidePointerEvents:!0,onEscapeKeyDown:d,onPointerDownOutside:a,onFocusOutside:j=>j.preventDefault(),onDismiss:()=>h.onOpenChange(!1),children:e.jsx(fe,{role:"listbox",id:h.contentId,"data-state":h.open?"open":"closed",dir:h.dir,onContextMenu:j=>j.preventDefault(),...w,...ue,onPlaced:()=>z(!0),ref:R,style:{display:"flex",flexDirection:"column",outline:"none",...w.style},onKeyDown:E(w.onKeyDown,j=>{const T=j.ctrlKey||j.altKey||j.metaKey;if(j.key==="Tab"&&j.preventDefault(),!T&&j.key.length===1&&he(j.key),["ArrowUp","ArrowDown","Home","End"].includes(j.key)){let b=W().filter(C=>!C.disabled).map(C=>C.ref.current);if(["ArrowUp","End"].includes(j.key)&&(b=b.slice().reverse()),["ArrowUp","ArrowDown"].includes(j.key)){const C=j.target,P=b.indexOf(C);b=b.slice(P+1)}setTimeout(()=>A(b)),j.preventDefault()}})})})})})})});kt.displayName=$n;var Fn="SelectItemAlignedPosition",At=r.forwardRef((t,n)=>{const{__scopeSelect:s,onPlaced:c,...o}=t,d=Q(oe,s),a=ee(oe,s),[i,l]=r.useState(null),[u,m]=r.useState(null),x=B(n,R=>m(R)),f=Se(s),y=r.useRef(!1),g=r.useRef(!0),{viewport:p,selectedItem:v,selectedItemText:w,focusSelectedItem:h}=a,N=r.useCallback(()=>{if(d.trigger&&d.valueNode&&i&&u&&p&&v&&w){const R=d.trigger.getBoundingClientRect(),O=u.getBoundingClientRect(),S=d.valueNode.getBoundingClientRect(),U=w.getBoundingClientRect();if(d.dir!=="rtl"){const C=U.left-O.left,P=S.left-C,se=R.left-P,ne=R.width+se,Te=Math.max(ne,O.width),Pe=window.innerWidth-V,Ee=Ye(P,[V,Math.max(V,Pe-Te)]);i.style.minWidth=ne+"px",i.style.left=Ee+"px"}else{const C=O.right-U.right,P=window.innerWidth-S.right-C,se=window.innerWidth-R.right-P,ne=R.width+se,Te=Math.max(ne,O.width),Pe=window.innerWidth-V,Ee=Ye(P,[V,Math.max(V,Pe-Te)]);i.style.minWidth=ne+"px",i.style.right=Ee+"px"}const I=f(),W=window.innerHeight-V*2,q=p.scrollHeight,z=window.getComputedStyle(u),G=parseInt(z.borderTopWidth,10),A=parseInt(z.paddingTop,10),F=parseInt(z.borderBottomWidth,10),K=parseInt(z.paddingBottom,10),Y=G+A+q+K+F,be=Math.min(v.offsetHeight*5,Y),he=window.getComputedStyle(p),Ce=parseInt(he.paddingTop,10),Ie=parseInt(he.paddingBottom,10),ae=R.top+R.height/2-V,fe=W-ae,ue=v.offsetHeight/2,j=v.offsetTop+ue,T=G+A+j,M=Y-T;if(T<=ae){const C=I.length>0&&v===I[I.length-1].ref.current;i.style.bottom="0px";const P=u.clientHeight-p.offsetTop-p.offsetHeight,se=Math.max(fe,ue+(C?Ie:0)+P+F),ne=T+se;i.style.height=ne+"px"}else{const C=I.length>0&&v===I[0].ref.current;i.style.top="0px";const se=Math.max(ae,G+p.offsetTop+(C?Ce:0)+ue)+M;i.style.height=se+"px",p.scrollTop=T-ae+p.offsetTop}i.style.margin=`${V}px 0`,i.style.minHeight=be+"px",i.style.maxHeight=W+"px",c?.(),requestAnimationFrame(()=>y.current=!0)}},[f,d.trigger,d.valueNode,i,u,p,v,w,d.dir,c]);J(()=>N(),[N]);const[_,k]=r.useState();J(()=>{u&&k(window.getComputedStyle(u).zIndex)},[u]);const te=r.useCallback(R=>{R&&g.current===!0&&(N(),h?.(),g.current=!1)},[N,h]);return e.jsx(zn,{scope:s,contentWrapper:i,shouldExpandOnScrollRef:y,onScrollButtonChange:te,children:e.jsx("div",{ref:l,style:{display:"flex",flexDirection:"column",position:"fixed",zIndex:_},children:e.jsx(L.div,{...o,ref:x,style:{boxSizing:"border-box",maxHeight:"100%",...o.style}})})})});At.displayName=Fn;var Wn="SelectPopperPosition",De=r.forwardRef((t,n)=>{const{__scopeSelect:s,align:c="start",collisionPadding:o=V,...d}=t,a=we(s);return e.jsx(bs,{...a,...d,ref:n,align:c,collisionPadding:o,style:{boxSizing:"border-box",...d.style,"--radix-select-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-select-content-available-width":"var(--radix-popper-available-width)","--radix-select-content-available-height":"var(--radix-popper-available-height)","--radix-select-trigger-width":"var(--radix-popper-anchor-width)","--radix-select-trigger-height":"var(--radix-popper-anchor-height)"}})});De.displayName=Wn;var[zn,Fe]=de(oe,{}),Le="SelectViewport",Mt=r.forwardRef((t,n)=>{const{__scopeSelect:s,nonce:c,...o}=t,d=ee(Le,s),a=Fe(Le,s),i=B(n,d.onViewportChange),l=r.useRef(0);return e.jsxs(e.Fragment,{children:[e.jsx("style",{dangerouslySetInnerHTML:{__html:"[data-radix-select-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-select-viewport]::-webkit-scrollbar{display:none}"},nonce:c}),e.jsx(Ne.Slot,{scope:s,children:e.jsx(L.div,{"data-radix-select-viewport":"",role:"presentation",...o,ref:i,style:{position:"relative",flex:1,overflow:"hidden auto",...o.style},onScroll:E(o.onScroll,u=>{const m=u.currentTarget,{contentWrapper:x,shouldExpandOnScrollRef:f}=a;if(f?.current&&x){const y=Math.abs(l.current-m.scrollTop);if(y>0){const g=window.innerHeight-V*2,p=parseFloat(x.style.minHeight),v=parseFloat(x.style.height),w=Math.max(p,v);if(w<g){const h=w+y,N=Math.min(g,h),_=h-N;x.style.height=N+"px",x.style.bottom==="0px"&&(m.scrollTop=_>0?_:0,x.style.justifyContent="flex-end")}}}l.current=m.scrollTop})})})]})});Mt.displayName=Le;var Dt="SelectGroup",[Gn,Kn]=de(Dt),qn=r.forwardRef((t,n)=>{const{__scopeSelect:s,...c}=t,o=He();return e.jsx(Gn,{scope:s,id:o,children:e.jsx(L.div,{role:"group","aria-labelledby":o,...c,ref:n})})});qn.displayName=Dt;var Lt="SelectLabel",Ot=r.forwardRef((t,n)=>{const{__scopeSelect:s,...c}=t,o=Kn(Lt,s);return e.jsx(L.div,{id:o.id,...c,ref:n})});Ot.displayName=Lt;var je="SelectItem",[Yn,Bt]=de(je),Ut=r.forwardRef((t,n)=>{const{__scopeSelect:s,value:c,disabled:o=!1,textValue:d,...a}=t,i=Q(je,s),l=ee(je,s),u=i.value===c,[m,x]=r.useState(d??""),[f,y]=r.useState(!1),g=B(n,h=>l.itemRefCallback?.(h,c,o)),p=He(),v=r.useRef("touch"),w=()=>{o||(i.onValueChange(c),i.onOpenChange(!1))};if(c==="")throw new Error("A <Select.Item /> must have a value prop that is not an empty string. This is because the Select value can be set to an empty string to clear the selection and show the placeholder.");return e.jsx(Yn,{scope:s,value:c,disabled:o,textId:p,isSelected:u,onItemTextChange:r.useCallback(h=>{x(N=>N||(h?.textContent??"").trim())},[]),children:e.jsx(Ne.ItemSlot,{scope:s,value:c,disabled:o,textValue:m,children:e.jsx(L.div,{role:"option","aria-labelledby":p,"data-highlighted":f?"":void 0,"aria-selected":u&&f,"data-state":u?"checked":"unchecked","aria-disabled":o||void 0,"data-disabled":o?"":void 0,tabIndex:o?void 0:-1,...a,ref:g,onFocus:E(a.onFocus,()=>y(!0)),onBlur:E(a.onBlur,()=>y(!1)),onClick:E(a.onClick,()=>{v.current!=="mouse"&&w()}),onPointerUp:E(a.onPointerUp,()=>{v.current==="mouse"&&w()}),onPointerDown:E(a.onPointerDown,h=>{v.current=h.pointerType}),onPointerMove:E(a.onPointerMove,h=>{v.current=h.pointerType,o?l.onItemLeave?.():v.current==="mouse"&&h.currentTarget.focus({preventScroll:!0})}),onPointerLeave:E(a.onPointerLeave,h=>{h.currentTarget===document.activeElement&&l.onItemLeave?.()}),onKeyDown:E(a.onKeyDown,h=>{l.searchRef?.current!==""&&h.key===" "||(Mn.includes(h.key)&&w(),h.key===" "&&h.preventDefault())})})})})});Ut.displayName=je;var me="SelectItemText",Vt=r.forwardRef((t,n)=>{const{__scopeSelect:s,className:c,style:o,...d}=t,a=Q(me,s),i=ee(me,s),l=Bt(me,s),u=Bn(me,s),[m,x]=r.useState(null),f=B(n,w=>x(w),l.onItemTextChange,w=>i.itemTextRefCallback?.(w,l.value,l.disabled)),y=m?.textContent,g=r.useMemo(()=>e.jsx("option",{value:l.value,disabled:l.disabled,children:y},l.value),[l.disabled,l.value,y]),{onNativeOptionAdd:p,onNativeOptionRemove:v}=u;return J(()=>(p(g),()=>v(g)),[p,v,g]),e.jsxs(e.Fragment,{children:[e.jsx(L.span,{id:l.textId,...d,ref:f}),l.isSelected&&a.valueNode&&!a.valueNodeHasChildren?Xe.createPortal(d.children,a.valueNode):null]})});Vt.displayName=me;var $t="SelectItemIndicator",Ht=r.forwardRef((t,n)=>{const{__scopeSelect:s,...c}=t;return Bt($t,s).isSelected?e.jsx(L.span,{"aria-hidden":!0,...c,ref:n}):null});Ht.displayName=$t;var Oe="SelectScrollUpButton",Ft=r.forwardRef((t,n)=>{const s=ee(Oe,t.__scopeSelect),c=Fe(Oe,t.__scopeSelect),[o,d]=r.useState(!1),a=B(n,c.onScrollButtonChange);return J(()=>{if(s.viewport&&s.isPositioned){let i=function(){const u=l.scrollTop>0;d(u)};const l=s.viewport;return i(),l.addEventListener("scroll",i),()=>l.removeEventListener("scroll",i)}},[s.viewport,s.isPositioned]),o?e.jsx(zt,{...t,ref:a,onAutoScroll:()=>{const{viewport:i,selectedItem:l}=s;i&&l&&(i.scrollTop=i.scrollTop-l.offsetHeight)}}):null});Ft.displayName=Oe;var Be="SelectScrollDownButton",Wt=r.forwardRef((t,n)=>{const s=ee(Be,t.__scopeSelect),c=Fe(Be,t.__scopeSelect),[o,d]=r.useState(!1),a=B(n,c.onScrollButtonChange);return J(()=>{if(s.viewport&&s.isPositioned){let i=function(){const u=l.scrollHeight-l.clientHeight,m=Math.ceil(l.scrollTop)<u;d(m)};const l=s.viewport;return i(),l.addEventListener("scroll",i),()=>l.removeEventListener("scroll",i)}},[s.viewport,s.isPositioned]),o?e.jsx(zt,{...t,ref:a,onAutoScroll:()=>{const{viewport:i,selectedItem:l}=s;i&&l&&(i.scrollTop=i.scrollTop+l.offsetHeight)}}):null});Wt.displayName=Be;var zt=r.forwardRef((t,n)=>{const{__scopeSelect:s,onAutoScroll:c,...o}=t,d=ee("SelectScrollButton",s),a=r.useRef(null),i=Se(s),l=r.useCallback(()=>{a.current!==null&&(window.clearInterval(a.current),a.current=null)},[]);return r.useEffect(()=>()=>l(),[l]),J(()=>{i().find(m=>m.ref.current===document.activeElement)?.ref.current?.scrollIntoView({block:"nearest"})},[i]),e.jsx(L.div,{"aria-hidden":!0,...o,ref:n,style:{flexShrink:0,...o.style},onPointerDown:E(o.onPointerDown,()=>{a.current===null&&(a.current=window.setInterval(c,50))}),onPointerMove:E(o.onPointerMove,()=>{d.onItemLeave?.(),a.current===null&&(a.current=window.setInterval(c,50))}),onPointerLeave:E(o.onPointerLeave,()=>{l()})})}),Zn="SelectSeparator",Gt=r.forwardRef((t,n)=>{const{__scopeSelect:s,...c}=t;return e.jsx(L.div,{"aria-hidden":!0,...c,ref:n})});Gt.displayName=Zn;var Ue="SelectArrow",Xn=r.forwardRef((t,n)=>{const{__scopeSelect:s,...c}=t,o=we(s),d=Q(Ue,s),a=ee(Ue,s);return d.open&&a.position==="popper"?e.jsx(Cs,{...o,...c,ref:n}):null});Xn.displayName=Ue;var Jn="SelectBubbleInput",Kt=r.forwardRef(({__scopeSelect:t,value:n,...s},c)=>{const o=r.useRef(null),d=B(c,o),a=Qe(n);return r.useEffect(()=>{const i=o.current;if(!i)return;const l=window.HTMLSelectElement.prototype,m=Object.getOwnPropertyDescriptor(l,"value").set;if(a!==n&&m){const x=new Event("change",{bubbles:!0});m.call(i,n),i.dispatchEvent(x)}},[a,n]),e.jsx(L.select,{...s,style:{...ms,...s.style},ref:d,defaultValue:n})});Kt.displayName=Jn;function qt(t){return t===""||t===void 0}function Yt(t){const n=xs(t),s=r.useRef(""),c=r.useRef(0),o=r.useCallback(a=>{const i=s.current+a;n(i),(function l(u){s.current=u,window.clearTimeout(c.current),u!==""&&(c.current=window.setTimeout(()=>l(""),1e3))})(i)},[n]),d=r.useCallback(()=>{s.current="",window.clearTimeout(c.current)},[]);return r.useEffect(()=>()=>window.clearTimeout(c.current),[]),[s,o,d]}function Zt(t,n,s){const o=n.length>1&&Array.from(n).every(u=>u===n[0])?n[0]:n,d=s?t.indexOf(s):-1;let a=Qn(t,Math.max(d,0));o.length===1&&(a=a.filter(u=>u!==s));const l=a.find(u=>u.textValue.toLowerCase().startsWith(o.toLowerCase()));return l!==s?l:void 0}function Qn(t,n){return t.map((s,c)=>t[(n+c)%t.length])}var er=wt,Xt=Ct,tr=Tt,sr=Pt,nr=Et,Jt=_t,rr=Mt,Qt=Ot,es=Ut,or=Vt,ar=Ht,ts=Ft,ss=Wt,ns=Gt;const cr=er,ir=tr,rs=r.forwardRef(({className:t,children:n,...s},c)=>e.jsxs(Xt,{ref:c,className:$("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1 transition-transform duration-150 ease-in-out active:scale-98",t),...s,children:[n,e.jsx(sr,{asChild:!0,children:e.jsx(ot,{className:"h-4 w-4 opacity-50"})})]}));rs.displayName=Xt.displayName;const os=r.forwardRef(({className:t,...n},s)=>e.jsx(ts,{ref:s,className:$("flex cursor-default items-center justify-center py-1",t),...n,children:e.jsx(Is,{className:"h-4 w-4"})}));os.displayName=ts.displayName;const as=r.forwardRef(({className:t,...n},s)=>e.jsx(ss,{ref:s,className:$("flex cursor-default items-center justify-center py-1",t),...n,children:e.jsx(ot,{className:"h-4 w-4"})}));as.displayName=ss.displayName;const cs=r.forwardRef(({className:t,children:n,position:s="popper",...c},o)=>e.jsx(nr,{children:e.jsxs(Jt,{ref:o,className:$("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",s==="popper"&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",t),position:s,...c,children:[e.jsx(os,{}),e.jsx(rr,{className:$("p-1",s==="popper"&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:n}),e.jsx(as,{})]})}));cs.displayName=Jt.displayName;const lr=r.forwardRef(({className:t,...n},s)=>e.jsx(Qt,{ref:s,className:$("py-1.5 pl-8 pr-2 text-sm font-semibold",t),...n}));lr.displayName=Qt.displayName;const ge=r.forwardRef(({className:t,children:n,...s},c)=>e.jsxs(es,{ref:c,className:$("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 transition-transform duration-150 ease-in-out active:scale-95",t),...s,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(ar,{children:e.jsx(Os,{className:"h-4 w-4"})})}),e.jsx(or,{children:n})]}));ge.displayName=es.displayName;const dr=r.forwardRef(({className:t,...n},s)=>e.jsx(ns,{ref:s,className:$("-mx-1 my-1 h-px bg-muted",t),...n}));dr.displayName=ns.displayName;function ur({user:t,open:n,onOpenChange:s,onSuccess:c}){const[o,d]=r.useState(!1),[a,i]=r.useState({username:"",email:"",role:"user"}),{toast:l}=Ve();r.useEffect(()=>{t&&i({username:t.name,email:t.email,role:t.role==="管理员"?"admin":"user"})},[t]);const u=async m=>{if(m.preventDefault(),!!t){d(!0);try{const f=await(await fetch("/api/admin/users",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:t.id,...a})})).json();f.success?(l({title:"更新成功",description:"用户信息已更新"}),c(),s(!1)):l({title:"更新失败",description:f.error,variant:"destructive"})}catch{l({title:"更新失败",description:"网络错误，请稍后重试",variant:"destructive"})}finally{d(!1)}}};return e.jsx(at,{open:n,onOpenChange:s,children:e.jsxs(ct,{children:[e.jsxs(it,{children:[e.jsx(lt,{children:"编辑用户"}),e.jsx(dt,{children:"修改用户的基本信息和权限"})]}),e.jsxs("form",{onSubmit:u,children:[e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(le,{htmlFor:"username",children:"用户名"}),e.jsx(Re,{id:"username",value:a.username,onChange:m=>i({...a,username:m.target.value}),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(le,{htmlFor:"email",children:"邮箱"}),e.jsx(Re,{id:"email",type:"email",value:a.email,onChange:m=>i({...a,email:m.target.value}),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(le,{children:"角色"}),e.jsx(Bs,{value:a.role,onValueChange:m=>i({...a,role:m}),children:e.jsxs(Us,{className:"grid w-full grid-cols-2",children:[e.jsx(We,{value:"user",children:"普通用户"}),e.jsx(We,{value:"admin",children:"管理员"})]})})]})]}),e.jsxs(Ds,{children:[e.jsx(D,{type:"button",variant:"outline",onClick:()=>s(!1),disabled:o,children:"取消"}),e.jsxs(D,{type:"submit",disabled:o,children:[o&&e.jsx($e,{className:"mr-2 h-4 w-4 animate-spin"}),"保存"]})]})]})]})})}function mr({user:t,open:n,onOpenChange:s}){if(!t)return null;const c=o=>{if(!o)return"从未活跃";try{return new Date(o).toLocaleString("zh-CN")}catch{return"无效日期"}};return e.jsx(at,{open:n,onOpenChange:s,children:e.jsxs(ct,{className:"max-w-2xl",children:[e.jsxs(it,{children:[e.jsx(lt,{children:"用户详情"}),e.jsx(dt,{children:"查看用户的详细信息"})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"h-16 w-16 rounded-full bg-primary/10 flex items-center justify-center",children:e.jsx(ze,{className:"h-8 w-8 text-primary"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("h3",{className:"text-xl font-semibold",children:t.name}),e.jsx(ie,{variant:t.role==="管理员"?"default":"secondary",children:t.role}),t.status==="banned"&&e.jsx(ie,{className:"bg-red-500/10 text-red-500 border-red-500/20",children:"已封禁"})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(Vs,{className:"h-4 w-4"}),t.email]})]})]}),e.jsx(nt,{}),e.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"text-sm font-medium",children:"账户信息"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(ke,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"text-muted-foreground",children:"注册时间："}),e.jsx("span",{children:t.joinDate})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(ze,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"text-muted-foreground",children:"用户ID："}),e.jsx("span",{className:"font-mono text-xs",children:t.id})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(ke,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"text-muted-foreground",children:"最后活跃："}),e.jsx("span",{children:c(t.lastActiveAt)})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"text-sm font-medium",children:"使用统计"}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"p-3 rounded-lg bg-muted/50",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"对话数"}),e.jsx("span",{className:"text-lg font-semibold",children:t.conversationCount})]})}),e.jsx("div",{className:"p-3 rounded-lg bg-muted/50",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"消息数"}),e.jsx("span",{className:"text-lg font-semibold",children:t.messageCount})]})})]})]})]})]})]})})}function pr({searchQuery:t,onSearchChange:n}){const[s,c]=r.useState([]),[o,d]=r.useState(!1),[a,i]=r.useState(1),[l,u]=r.useState(0),[m,x]=r.useState(0),[f,y]=r.useState("all"),[g,p]=r.useState(null),[v,w]=r.useState(!1),[h,N]=r.useState(!1),{toast:_}=Ve(),k=async()=>{d(!0);try{const S=new URLSearchParams({search:t,status:f,page:a.toString(),pageSize:"10"}),I=await(await fetch(`/api/admin/users?${S}`)).json();I.success?(c(I.data.users),u(I.data.total),x(I.data.totalPages)):_({title:"获取失败",description:I.error||"无法加载用户列表",variant:"destructive"})}catch(S){console.error("获取用户列表失败:",S),_({title:"获取失败",description:"网络错误，请稍后重试",variant:"destructive"})}finally{d(!1)}};r.useEffect(()=>{k()},[t,f,a]);const te=S=>{p(S),N(!0)},R=S=>{p(S),w(!0)},O=async S=>{if(confirm("确定要删除此用户吗？此操作无法撤销。"))try{const I=await(await fetch(`/api/admin/users?userId=${S}`,{method:"DELETE"})).json();I.success?(_({title:"删除成功",description:I.message}),k()):_({title:"删除失败",description:I.error,variant:"destructive"})}catch(U){console.error("删除用户失败:",U),_({title:"删除失败",description:"网络错误，请稍后重试",variant:"destructive"})}};return e.jsxs("div",{className:"space-y-6 animate-in fade-in-50 duration-300",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold mb-2",children:"用户管理"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["管理和监控所有用户账户 (共 ",l," 人)"]})]}),e.jsxs(D,{className:"gap-2",children:[e.jsx(pt,{className:"h-4 w-4"}),"导出用户"]})]}),e.jsx(Z,{children:e.jsx(X,{className:"pt-6",children:e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(Hs,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(Re,{placeholder:"搜索用户名、邮箱...",value:t,onChange:S=>n(S.target.value),className:"pl-10"})]}),e.jsxs(cr,{value:f,onValueChange:y,children:[e.jsxs(rs,{className:"w-[180px]",children:[e.jsx(Xs,{className:"h-4 w-4 mr-2"}),e.jsx(ir,{placeholder:"筛选角色"})]}),e.jsxs(cs,{children:[e.jsx(ge,{value:"all",children:"全部用户"}),e.jsx(ge,{value:"user",children:"普通用户"}),e.jsx(ge,{value:"admin",children:"管理员"})]})]})]})})}),e.jsxs(Z,{children:[e.jsx(pe,{children:e.jsxs(xe,{className:"text-lg flex items-center gap-2",children:[e.jsx(ce,{className:"h-5 w-5"}),"用户列表"]})}),e.jsx(X,{children:o?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx($e,{className:"h-8 w-8 animate-spin text-muted-foreground"})}):s.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(ce,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"暂无用户数据"})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"space-y-3",children:s.map(S=>e.jsxs("div",{className:"flex items-center justify-between p-4 rounded-lg border border-border/40 hover:bg-muted/50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"h-10 w-10 rounded-full bg-primary/10 flex items-center justify-center",children:e.jsx(ce,{className:"h-5 w-5 text-primary"})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"font-medium",children:S.name}),e.jsx(ie,{variant:S.role==="管理员"?"default":"secondary",className:"text-xs",children:S.role})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:S.email}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["加入: ",S.joinDate," | 对话: ",S.conversationCount," | 消息: ",S.messageCount]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(D,{variant:"ghost",size:"icon",title:"查看详情",onClick:()=>te(S),children:e.jsx($s,{className:"h-4 w-4"})}),e.jsx(D,{variant:"ghost",size:"icon",title:"编辑",onClick:()=>R(S),children:e.jsx(Qs,{className:"h-4 w-4"})}),e.jsx(D,{variant:"ghost",size:"icon",title:"删除",className:"text-red-500 hover:text-red-600 hover:bg-red-500/10",onClick:()=>O(S.id),children:e.jsx(Ts,{className:"h-4 w-4"})})]})]},S.id))}),m>1&&e.jsxs("div",{className:"flex items-center justify-between mt-6 pt-6 border-t",children:[e.jsxs("p",{className:"text-sm text-muted-foreground",children:["第 ",a," 页，共 ",m," 页"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(D,{variant:"outline",size:"sm",onClick:()=>i(S=>Math.max(1,S-1)),disabled:a===1,children:[e.jsx(Ps,{className:"h-4 w-4"}),"上一页"]}),e.jsxs(D,{variant:"outline",size:"sm",onClick:()=>i(S=>Math.min(m,S+1)),disabled:a===m,children:["下一页",e.jsx(Es,{className:"h-4 w-4"})]})]})]})]})})]}),e.jsx(ur,{user:g,open:v,onOpenChange:w,onSuccess:k}),e.jsx(mr,{user:g,open:h,onOpenChange:N})]})}function xr(){const t=fs(),{user:n,initialized:s}=gs(),[c,o]=r.useState(!0),[d,a]=r.useState("overview");if(r.useEffect(()=>{(async()=>{if(s)try{if(!n){t({to:"/auth/login"});return}if(n.role!=="admin"){t({to:"/"});return}o(!1)}catch(u){console.error("管理员权限检查失败:",u),t({to:"/"})}})()},[t,n,s]),c)return e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsxs("div",{className:"flex flex-col items-center gap-4",children:[e.jsx($e,{className:"h-8 w-8 animate-spin text-blue-600"}),e.jsx("p",{className:"text-gray-600",children:"验证管理员权限中..."})]})});const i=()=>{switch(d){case"overview":return e.jsx(qe,{});case"users":return e.jsx(pr,{});case"analytics":return e.jsx(ln,{});case"system":return e.jsx(bn,{});default:return e.jsx(qe,{})}};return e.jsx("div",{className:"min-h-screen bg-gray-50",children:e.jsxs("div",{className:"flex",children:[e.jsx(on,{activeSection:d,onSectionChange:a}),e.jsx("main",{className:"flex-1 p-8",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-8",children:[e.jsx(Je,{className:"h-8 w-8 text-blue-600"}),e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"管理后台"})]}),i()]})})]})})}function kr(){return e.jsx(Ls,{children:e.jsx(xr,{})})}export{kr as component};
