import{c as L,j as e,r as t,u as J,a as O,L as U,e as V}from"./main-ARwKK-j-.js";import{P as B}from"./ProtectedRoute-BxFyMMUm.js";import{A as R,a as q}from"./avatar-DdQ2Vt8-.js";import{B as u}from"./button-Bs-EW9hM.js";import{C as v,a as N,b,d as y,I as A,c as G}from"./input-bDnrxQmw.js";import{L as I}from"./label-gAYxsn89.js";import{L as M}from"./loader-circle-DRCGxcyM.js";import{A as $}from"./arrow-left-Be3PFbWq.js";import{U as z}from"./user-DvP510wh.js";import{C as E}from"./chart-column-CUgiwHgL.js";import{M as K}from"./mail-DLPs3P3A.js";import{C as Q}from"./calendar-38JwHQpT.js";import"./index-BwYya6qp.js";const W=[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]],X=L("save",W);const Y=[["path",{d:"M10 14.66v1.626a2 2 0 0 1-.976 1.696A5 5 0 0 0 7 21.978",key:"1n3hpd"}],["path",{d:"M14 14.66v1.626a2 2 0 0 0 .976 1.696A5 5 0 0 1 17 21.978",key:"rfe1zi"}],["path",{d:"M18 9h1.5a1 1 0 0 0 0-5H18",key:"7xy6bh"}],["path",{d:"M4 22h16",key:"57wxv0"}],["path",{d:"M6 9a6 6 0 0 0 12 0V3a1 1 0 0 0-1-1H7a1 1 0 0 0-1 1z",key:"1mhfuq"}],["path",{d:"M6 9H4.5a1 1 0 0 1 0-5H6",key:"tex48p"}]],w=L("trophy",Y);async function Z(){try{const a=localStorage.getItem("auth-storage");if(!a)return console.error("用户未登录"),null;const{state:r}=JSON.parse(a),c=r.user;if(!c)return console.error("用户未登录"),null;const i=await fetch("/api/profile",{method:"GET",headers:{"Content-Type":"application/json","x-user-id":c.id}});return i.ok?await i.json():(console.error("获取用户资料失败:",i.statusText),null)}catch(a){return console.error("获取用户资料错误:",a),null}}async function ee(a){try{const r=localStorage.getItem("auth-storage");if(!r)return{success:!1,error:"用户未登录"};const{state:c}=JSON.parse(r),i=c.user;if(!i)return{success:!1,error:"用户未登录"};const n=await fetch("/api/profile",{method:"PATCH",headers:{"Content-Type":"application/json","x-user-id":i.id},body:JSON.stringify(a)});return n.ok?{success:!0}:{success:!1,error:(await n.json()).error||"更新失败"}}catch(r){return console.error("更新用户资料错误:",r),{success:!1,error:"更新用户资料失败"}}}const se=[{id:"basic",label:"基本信息",icon:z},{id:"stats",label:"使用统计",icon:E},{id:"achievements",label:"成就徽章",icon:w}];function fe(){return e.jsx(B,{children:e.jsx(te,{})})}function te(){const a=t.useId(),r=t.useId(),{toast:c}=J(),{user:i,initialized:n,initialize:h}=O(),[m,H]=t.useState("basic"),[C,p]=t.useState(!1),[T,S]=t.useState(!0),[x,k]=t.useState(!1),[o,P]=t.useState({id:"",username:"用户",email:"user@example.com",joinDate:"2024-01-01"}),[f,D]=t.useState({conversationCount:0,messageCount:0,activeDays:0}),[j,_]=t.useState([]),[d,g]=t.useState(o);t.useEffect(()=>{n||h()},[n,h]),t.useEffect(()=>{(async()=>{if(!n)return;S(!0);const l=await Z();l&&(P(l.profile),g(l.profile),D(l.stats),_(l.achievements)),S(!1)})()},[i,n]);const F=async()=>{k(!0);const s=await ee({username:d.username});s.success?(P(d),p(!1),c({title:"保存成功",description:"您的资料已更新"})):c({title:"保存失败",description:s.error||"更新资料失败",variant:"destructive"}),k(!1)};return T?e.jsx("div",{className:"flex h-screen items-center justify-center bg-background",children:e.jsx(M,{className:"h-8 w-8 animate-spin text-primary"})}):e.jsxs("div",{className:"flex h-screen bg-background",children:[e.jsxs("div",{className:"w-64 border-r border-border/40 bg-muted/30 flex flex-col",children:[e.jsx("div",{className:"p-4 border-b border-border/40",children:e.jsx(U,{to:"/chat",children:e.jsxs(u,{variant:"ghost",size:"sm",className:"w-full justify-start gap-2 hover:bg-muted",children:[e.jsx($,{className:"h-4 w-4"}),e.jsx("span",{children:"返回聊天"})]})})}),e.jsx("div",{className:"px-4 py-6",children:e.jsx("h1",{className:"text-xl font-semibold",children:"个人资料"})}),e.jsx("nav",{className:"flex-1 px-2 pb-4 space-y-1 overflow-y-auto",children:se.map(s=>{const l=s.icon;return e.jsxs("button",{type:"button",onClick:()=>H(s.id),className:V("w-full flex items-center gap-3 px-3 py-2.5 rounded-lg text-sm font-medium transition-colors",m===s.id?"bg-muted text-foreground":"text-muted-foreground hover:bg-muted/50"),children:[e.jsx(l,{className:"h-4 w-4"}),e.jsx("span",{children:s.label})]},s.id)})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:e.jsxs("div",{className:"max-w-3xl mx-auto p-8",children:[m==="basic"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold mb-2",children:"基本信息"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"管理你的个人资料"})]}),C?e.jsxs("div",{className:"flex gap-2",children:[e.jsx(u,{onClick:()=>{g(o),p(!1)},variant:"outline",size:"sm",disabled:x,children:"取消"}),e.jsxs(u,{onClick:F,size:"sm",disabled:x,children:[x?e.jsx(M,{className:"h-4 w-4 animate-spin"}):e.jsx(X,{className:"h-4 w-4"}),x?"保存中...":"保存"]})]}):e.jsx(u,{onClick:()=>p(!0),variant:"outline",children:"编辑资料"})]}),e.jsxs(v,{children:[e.jsx(N,{children:e.jsxs(b,{className:"text-lg flex items-center gap-2",children:[e.jsx(z,{className:"h-5 w-5"}),"个人资料"]})}),e.jsxs(y,{className:"space-y-6",children:[e.jsx(R,{className:"h-20 w-20 border-4 border-primary/20",children:e.jsx(q,{className:"text-2xl bg-gradient-to-br from-primary to-primary/60",children:o.username.charAt(0).toUpperCase()})}),C?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(I,{htmlFor:a,children:"用户名"}),e.jsx(A,{id:a,value:d.username,onChange:s=>g({...d,username:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(I,{htmlFor:r,children:"邮箱"}),e.jsx(A,{id:r,value:d.email,disabled:!0,className:"bg-muted"})]})]}):e.jsxs("div",{className:"p-4 rounded-lg bg-muted/50 space-y-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"用户名"}),e.jsx("p",{className:"text-sm font-medium",children:o.username})]}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-xs text-muted-foreground flex items-center gap-1",children:[e.jsx(K,{className:"h-3 w-3"}),"邮箱"]}),e.jsx("p",{className:"text-sm font-medium",children:o.email})]}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-xs text-muted-foreground flex items-center gap-1",children:[e.jsx(Q,{className:"h-3 w-3"}),"加入日期"]}),e.jsx("p",{className:"text-sm font-medium",children:o.joinDate})]})]})]})]})]}),m==="stats"&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{children:e.jsx("h2",{className:"text-2xl font-bold mb-2",children:"使用统计"})}),e.jsxs(v,{children:[e.jsx(N,{children:e.jsxs(b,{className:"text-lg flex items-center gap-2",children:[e.jsx(E,{className:"h-5 w-5"}),"统计数据"]})}),e.jsx(y,{children:e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"text-center p-6 rounded-lg bg-primary/5 border border-primary/10",children:[e.jsx("div",{className:"text-3xl font-bold text-primary",children:f.conversationCount}),e.jsx("div",{className:"text-sm text-muted-foreground mt-2",children:"对话数"})]}),e.jsxs("div",{className:"text-center p-6 rounded-lg bg-primary/5 border border-primary/10",children:[e.jsx("div",{className:"text-3xl font-bold text-primary",children:f.messageCount}),e.jsx("div",{className:"text-sm text-muted-foreground mt-2",children:"消息数"})]}),e.jsxs("div",{className:"text-center p-6 rounded-lg bg-primary/5 border border-primary/10",children:[e.jsx("div",{className:"text-3xl font-bold text-primary",children:f.activeDays}),e.jsx("div",{className:"text-sm text-muted-foreground mt-2",children:"使用天数"})]})]})})]})]}),m==="achievements"&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{children:e.jsx("h2",{className:"text-2xl font-bold mb-2",children:"成就徽章"})}),e.jsxs(v,{children:[e.jsxs(N,{children:[e.jsxs(b,{className:"text-lg flex items-center gap-2",children:[e.jsx(w,{className:"h-5 w-5"}),"我的成就"]}),e.jsxs(G,{children:["已解锁 ",j.length," 个成就"]})]}),e.jsx(y,{children:j.length>0?e.jsx("div",{className:"grid grid-cols-2 gap-3",children:j.map(s=>e.jsxs("div",{className:"p-4 rounded-lg bg-muted/50 border flex items-center gap-3",children:[e.jsx("div",{className:"text-2xl",children:s.icon}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:s.name}),e.jsx("p",{className:"text-xs text-muted-foreground",children:s.description})]})]},s.id))}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(w,{className:"h-12 w-12 text-muted-foreground/50 mx-auto mb-4"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"暂无成就"})]})})]})]})]})})]})}export{fe as component};
