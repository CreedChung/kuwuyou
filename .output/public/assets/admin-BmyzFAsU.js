import{c as J,j as e,L as Jt,e as G,y as Qt,z as es,r,u as Oe,g as ts,n as He,k as ss,m as H,b as X,V as ns,l as E,o as rs,v as Ye,i as as,D as os,s as ls,a as is}from"./main-DK-6tAy6.js";import{B as k}from"./button-CkY6mUU2.js";import{A as cs}from"./arrow-left-DqSc4F88.js";import{S as Ze,u as ds}from"./index-D-dT9flG.js";import{C as Xe}from"./chart-column-C2e7aVKS.js";import{U as le}from"./users-Bz6ZPnhw.js";import{a as Je,S as Qe}from"./separator-DTmpWEO5.js";import{C as Y,a as pe,b as xe,c as ve,d as Z,I as Ee}from"./input-DIUOMSeW.js";import{b as et,c as tt,R as ms,A as us,C as ps,a as xs}from"./index-VHM_YL0a.js";import{M as st,C as hs,G as fs,a as nt,b as gs,T as vs,c as js,d as Ns}from"./trash-2-CqFCS5y2.js";import{C as Re}from"./calendar-BD_oSPbz.js";import{B as ie}from"./badge-B2XLYerX.js";import{L as ce}from"./label-DLI6lelt.js";import{S as Fe}from"./switch-CMDipCID.js";import{U as rt}from"./upload-B9MJuww7.js";import{u as ys}from"./index-BderMFzC.js";import{h as Ss,u as ws,R as bs,F as Cs,D as at,a as ot,b as lt,c as it,d as ct,e as Is}from"./dialog-BhgrcoQE.js";import{u as Ue}from"./index-PYy017pk.js";import{C as Ts}from"./check-CJQR7mE4.js";import{T as Ps,a as Es,b as $e}from"./tabs-Cvc1r5WF.js";import{L as Be}from"./loader-circle-DwSaV1tR.js";import{U as We}from"./user-D1E1GTT_.js";import{M as Rs}from"./mail-h5u8iRLy.js";import{S as _s}from"./search-QfF_392f.js";import{E as As}from"./eye-C6Zb2VdP.js";import{P as Ds}from"./ProtectedRoute-CdMrE4ef.js";import"./index-duIY_fkC.js";import"./react-icons.esm-OtnF4_QE.js";import"./index-DfIc-h-G.js";const Ms=[["path",{d:"M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2",key:"169zse"}]],dt=J("activity",Ms);const ks=[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]],Ls=J("circle-check-big",ks);const Os=[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]],Us=J("download",Os);const Bs=[["path",{d:"M10 20a1 1 0 0 0 .553.895l2 1A1 1 0 0 0 14 21v-7a2 2 0 0 1 .517-1.341L21.74 4.67A1 1 0 0 0 21 3H3a1 1 0 0 0-.742 1.67l7.225 7.989A2 2 0 0 1 10 14z",key:"sc7q7i"}]],Vs=J("funnel",Bs);const Hs=[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]],Fs=J("square-pen",Hs);const $s=[["path",{d:"M16 17h6v-6",key:"t6n2it"}],["path",{d:"m22 17-8.5-8.5-5 5L2 7",key:"x473p"}]],ze=J("trending-down",$s);const Ws=[["path",{d:"M16 7h6v6",key:"box55l"}],["path",{d:"m22 7-8.5 8.5-5-5L2 17",key:"1t1m79"}]],_e=J("trending-up",Ws);const zs=[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]],Ge=J("triangle-alert",zs),Gs=[{id:"overview",label:"概览",icon:Xe},{id:"users",label:"用户管理",icon:le},{id:"analytics",label:"数据分析",icon:dt},{id:"system",label:"系统设置",icon:Je}];function Ks({activeSection:t,onSectionChange:n}){return e.jsxs("div",{className:"w-64 border-r border-border/40 bg-muted/30 flex flex-col",children:[e.jsx("div",{className:"p-4 border-b border-border/40",children:e.jsx(Jt,{href:"/",children:e.jsxs(k,{variant:"ghost",size:"sm",className:"w-full justify-start gap-2 hover:bg-muted",children:[e.jsx(cs,{className:"h-4 w-4"}),e.jsx("span",{children:"返回"})]})})}),e.jsxs("div",{className:"px-4 py-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Ze,{className:"h-5 w-5 text-primary"}),e.jsx("h1",{className:"text-xl font-semibold",children:"管理员面板"})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"系统管理与监控"})]}),e.jsx("nav",{className:"flex-1 px-2 pb-4 space-y-1 overflow-y-auto",children:Gs.map(s=>{const l=s.icon,o=t===s.id;return e.jsxs("button",{type:"button",onClick:()=>n(s.id),className:G("w-full flex items-center gap-3 px-3 py-2.5 rounded-lg text-sm font-medium transition-colors",o?"bg-muted text-foreground":"text-muted-foreground hover:bg-muted/50 hover:text-foreground"),children:[e.jsx(l,{className:"h-4 w-4 shrink-0"}),e.jsx("span",{children:s.label})]},s.id)})})]})}const qs={totalUsers:0,activeUsers:0,totalRevenue:0,totalMessages:0,userGrowth:0,activeGrowth:0,revenueGrowth:0,messageGrowth:0},Ys={server:"normal",database:"normal",api:"normal",uptime:"0天 0小时",dbResponseTime:"0ms"},mt=Qt()(es(t=>({adminUser:null,isAdmin:!1,systemStats:qs,systemStatus:Ys,setAdminUser:n=>t({adminUser:n,isAdmin:n!==null}),updateSystemStats:n=>t(s=>({systemStats:{...s.systemStats,...n}})),updateSystemStatus:n=>t(s=>({systemStatus:{...s.systemStatus,...n}})),logout:()=>t({adminUser:null,isAdmin:!1})}),{name:"admin-storage",partialize:t=>({adminUser:t.adminUser,isAdmin:t.isAdmin})}));function Zs(){const{systemStats:t}=mt(),[n,s]=r.useState(null),[l,o]=r.useState(!1),d=async()=>{o(!0);try{const i=await(await fetch("/api/admin/analytics")).json();i.success&&s(i.data)}catch(a){console.error("获取分析数据失败:",a)}finally{o(!1)}};return r.useEffect(()=>{d()},[]),e.jsxs("div",{className:"space-y-6 animate-in fade-in-50 duration-300",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold mb-2",children:"数据分析"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"查看详细的数据统计和分析报告"})]}),e.jsxs(k,{variant:"outline",size:"sm",onClick:d,disabled:l,className:"gap-2",children:[e.jsx(et,{className:`h-4 w-4 ${l?"animate-spin":""}`}),"刷新"]})]}),e.jsxs(Y,{children:[e.jsxs(pe,{children:[e.jsxs(xe,{className:"text-lg flex items-center gap-2",children:[e.jsx(Xe,{className:"h-5 w-5"}),"使用统计"]}),e.jsx(ve,{children:"过去30天的使用数据"})]}),e.jsx(Z,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 rounded-lg bg-muted/50",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(st,{className:"h-5 w-5 text-primary"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"总消息数"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"所有用户消息"})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-2xl font-bold",children:n?.totalMessages.toLocaleString()||t.totalMessages.toLocaleString()}),e.jsxs("p",{className:"text-xs text-green-500 flex items-center gap-1 justify-end",children:[e.jsx(_e,{className:"h-3 w-3"}),"+",t.messageGrowth,"%"]})]})]}),e.jsxs("div",{className:"flex items-center justify-between p-4 rounded-lg bg-muted/50",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(le,{className:"h-5 w-5 text-primary"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"活跃用户"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"30天内活跃"})]})]}),e.jsx("p",{className:"text-2xl font-bold",children:n?.activeUsers.toLocaleString()||t.activeUsers.toLocaleString()})]}),e.jsxs("div",{className:"flex items-center justify-between p-4 rounded-lg bg-muted/50",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(hs,{className:"h-5 w-5 text-primary"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"平均响应时间"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"AI 响应速度"})]})]}),e.jsxs("p",{className:"text-2xl font-bold",children:[n?.avgResponseTime||"1.2","s"]})]}),e.jsxs("div",{className:"flex items-center justify-between p-4 rounded-lg bg-muted/50",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(fs,{className:"h-5 w-5 text-primary"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"API 调用次数"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"总请求数"})]})]}),e.jsx("p",{className:"text-2xl font-bold",children:n?.apiCalls.toLocaleString()||"0"})]})]})})]}),n?.dailyStats&&e.jsxs(Y,{children:[e.jsxs(pe,{children:[e.jsxs(xe,{className:"text-lg flex items-center gap-2",children:[e.jsx(Re,{className:"h-5 w-5"}),"每日统计"]}),e.jsx(ve,{children:"最近7天的活动趋势"})]}),e.jsx(Z,{children:e.jsx("div",{className:"space-y-2",children:n.dailyStats.slice(-7).map(a=>e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg bg-muted/50",children:[e.jsx("span",{className:"text-sm font-medium",children:a.date}),e.jsxs("div",{className:"flex items-center gap-4 text-sm",children:[e.jsxs("span",{className:"text-muted-foreground",children:["消息: ",e.jsx("span",{className:"font-medium text-foreground",children:a.messages})]}),e.jsxs("span",{className:"text-muted-foreground",children:["用户: ",e.jsx("span",{className:"font-medium text-foreground",children:a.users})]})]})]},a.date))})})]})]})}function Ke(){const{systemStats:t,systemStatus:n,updateSystemStats:s,updateSystemStatus:l}=mt(),[o,d]=r.useState(!1),a=async()=>{d(!0);try{const p=await(await fetch("/api/admin/stats")).json();p.success&&s(p.data)}catch(m){console.error("获取统计数据失败:",m)}finally{d(!1)}},i=async()=>{try{const p=await(await fetch("/api/admin/system")).json();p.success&&l(p.data)}catch(m){console.error("获取系统状态失败:",m)}};r.useEffect(()=>{a(),i();const m=setInterval(()=>{a(),i()},3e4);return()=>clearInterval(m)},[]);const c=m=>{switch(m){case"normal":return e.jsxs(ie,{className:"gap-1.5 bg-green-500/10 text-green-500 border-green-500/20",children:[e.jsx(Ls,{className:"h-3 w-3"}),"正常"]});case"warning":return e.jsxs(ie,{className:"gap-1.5 bg-yellow-500/10 text-yellow-500 border-yellow-500/20",children:[e.jsx(Ge,{className:"h-3 w-3"}),"警告"]});case"error":return e.jsxs(ie,{className:"gap-1.5 bg-red-500/10 text-red-500 border-red-500/20",children:[e.jsx(Ge,{className:"h-3 w-3"}),"错误"]})}};return e.jsxs("div",{className:"space-y-6 animate-in fade-in-50 duration-300",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold mb-2",children:"系统概览"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"查看系统整体运行状态和关键指标"})]}),e.jsxs(k,{variant:"outline",size:"sm",onClick:a,disabled:o,className:"gap-2",children:[e.jsx(et,{className:`h-4 w-4 ${o?"animate-spin":""}`}),"刷新"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[e.jsx(Y,{children:e.jsxs(Z,{className:"pt-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(le,{className:"h-5 w-5 text-muted-foreground"}),t.userGrowth>=0?e.jsx(_e,{className:"h-4 w-4 text-green-500"}):e.jsx(ze,{className:"h-4 w-4 text-red-500"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-2xl font-bold",children:t.totalUsers.toLocaleString()}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"总用户数"}),e.jsxs("p",{className:`text-xs font-medium ${t.userGrowth>=0?"text-green-500":"text-red-500"}`,children:[t.userGrowth>=0?"+":"",t.userGrowth,"%"]})]})]})}),e.jsx(Y,{children:e.jsxs(Z,{className:"pt-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(st,{className:"h-5 w-5 text-muted-foreground"}),t.messageGrowth>=0?e.jsx(_e,{className:"h-4 w-4 text-green-500"}):e.jsx(ze,{className:"h-4 w-4 text-red-500"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-2xl font-bold",children:t.totalMessages.toLocaleString()}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"消息总数"}),e.jsxs("p",{className:`text-xs font-medium ${t.messageGrowth>=0?"text-green-500":"text-red-500"}`,children:[t.messageGrowth>=0?"+":"",t.messageGrowth,"%"]})]})]})})]}),e.jsxs(Y,{children:[e.jsxs(pe,{children:[e.jsxs(xe,{className:"text-lg flex items-center gap-2",children:[e.jsx(dt,{className:"h-5 w-5"}),"系统状态"]}),e.jsx(ve,{children:"实时系统运行状态"})]}),e.jsx(Z,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"p-4 rounded-lg bg-muted/50",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"服务器状态"}),c(n.server)]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["运行时间: ",n.uptime]})]}),e.jsxs("div",{className:"p-4 rounded-lg bg-muted/50",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"数据库"}),c(n.database)]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["响应时间: ",n.dbResponseTime]})]}),e.jsxs("div",{className:"p-4 rounded-lg bg-muted/50",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"API 服务"}),c(n.api)]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:n.api==="normal"?"运行正常":"请求延迟较高"})]})]})})]})]})}function Xs({autoBackup:t,onAutoBackupChange:n}){const s=r.useId(),l=r.useId(),[o,d]=r.useState(!0),[a,i]=r.useState(!1),{toast:c}=Oe(),m=async()=>{i(!0);try{const j=await(await fetch("/api/admin/system/backup",{method:"POST"})).json();j.success?c({title:"备份成功",description:j.message||"数据库已成功备份"}):c({title:"备份失败",description:j.error||"数据库备份失败",variant:"destructive"})}catch{c({title:"备份失败",description:"网络错误，请稍后重试",variant:"destructive"})}finally{i(!1)}},p=async(x,j)=>{try{const N=await(await fetch("/api/admin/system",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({setting:x,value:j})})).json();N.success&&c({title:"设置已更新",description:N.message})}catch(S){console.error("更新设置失败:",S)}};return e.jsxs("div",{className:"space-y-6 animate-in fade-in-50 duration-300",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold mb-2",children:"系统设置"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"配置系统参数和功能选项"})]}),e.jsxs(Y,{children:[e.jsxs(pe,{children:[e.jsxs(xe,{className:"text-lg flex items-center gap-2",children:[e.jsx(Je,{className:"h-5 w-5"}),"系统配置"]}),e.jsx(ve,{children:"管理系统核心设置"})]}),e.jsxs(Z,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 rounded-lg bg-muted/50",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(ce,{htmlFor:s,className:"text-sm font-medium",children:"自动备份"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"每天自动备份数据库"})]}),e.jsx(Fe,{id:s,checked:t,onCheckedChange:x=>{n(x),p("autoBackup",x)}})]}),e.jsxs("div",{className:"flex items-center justify-between p-4 rounded-lg bg-muted/50",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(ce,{htmlFor:l,className:"text-sm font-medium",children:"自动更新"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"自动检查并安装系统更新"})]}),e.jsx(Fe,{id:l,checked:o,onCheckedChange:x=>{d(x),p("autoUpdate",x)}})]}),e.jsx(Qe,{}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(ce,{className:"text-sm font-medium",children:"数据库操作"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs(k,{variant:"outline",className:"flex-1 gap-2",onClick:m,disabled:a,children:[e.jsx(Us,{className:"h-4 w-4"}),a?"备份中...":"备份数据库"]}),e.jsxs(k,{variant:"outline",className:"flex-1 gap-2",children:[e.jsx(rt,{className:"h-4 w-4"}),"恢复数据库"]})]})]})]})]})]})}function qe(t,[n,s]){return Math.min(s,Math.max(n,t))}function Js(t,n=[]){let s=[];function l(d,a){const i=r.createContext(a),c=s.length;s=[...s,a];const m=x=>{const{scope:j,children:S,...N}=x,u=j?.[t]?.[c]||i,g=r.useMemo(()=>N,Object.values(N));return e.jsx(u.Provider,{value:g,children:S})};m.displayName=d+"Provider";function p(x,j){const S=j?.[t]?.[c]||i,N=r.useContext(S);if(N)return N;if(a!==void 0)return a;throw new Error(`\`${x}\` must be used within \`${d}\``)}return[m,p]}const o=()=>{const d=s.map(a=>r.createContext(a));return function(i){const c=i?.[t]||d;return r.useMemo(()=>({[`__scope${t}`]:{...i,[t]:c}}),[i,c])}};return o.scopeName=t,[l,Qs(o,...n)]}function Qs(...t){const n=t[0];if(t.length===1)return n;const s=()=>{const l=t.map(o=>({useScope:o(),scopeName:o.scopeName}));return function(d){const a=l.reduce((i,{useScope:c,scopeName:m})=>{const x=c(d)[`__scope${m}`];return{...i,...x}},{});return r.useMemo(()=>({[`__scope${n.scopeName}`]:a}),[a])}};return s.scopeName=n.scopeName,s}function ut(t){const n=en(t),s=r.forwardRef((l,o)=>{const{children:d,...a}=l,i=r.Children.toArray(d),c=i.find(sn);if(c){const m=c.props.children,p=i.map(x=>x===c?r.Children.count(m)>1?r.Children.only(null):r.isValidElement(m)?m.props.children:null:x);return e.jsx(n,{...a,ref:o,children:r.isValidElement(m)?r.cloneElement(m,void 0,p):null})}return e.jsx(n,{...a,ref:o,children:d})});return s.displayName=`${t}.Slot`,s}function en(t){const n=r.forwardRef((s,l)=>{const{children:o,...d}=s;if(r.isValidElement(o)){const a=rn(o),i=nn(d,o.props);return o.type!==r.Fragment&&(i.ref=l?ts(l,a):a),r.cloneElement(o,i)}return r.Children.count(o)>1?r.Children.only(null):null});return n.displayName=`${t}.SlotClone`,n}var tn=Symbol("radix.slottable");function sn(t){return r.isValidElement(t)&&typeof t.type=="function"&&"__radixId"in t.type&&t.type.__radixId===tn}function nn(t,n){const s={...n};for(const l in n){const o=t[l],d=n[l];/^on[A-Z]/.test(l)?o&&d?s[l]=(...i)=>{const c=d(...i);return o(...i),c}:o&&(s[l]=o):l==="style"?s[l]={...o,...d}:l==="className"&&(s[l]=[o,d].filter(Boolean).join(" "))}return{...t,...s}}function rn(t){let n=Object.getOwnPropertyDescriptor(t.props,"ref")?.get,s=n&&"isReactWarning"in n&&n.isReactWarning;return s?t.ref:(n=Object.getOwnPropertyDescriptor(t,"ref")?.get,s=n&&"isReactWarning"in n&&n.isReactWarning,s?t.props.ref:t.props.ref||t.ref)}var an=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],L=an.reduce((t,n)=>{const s=ut(`Primitive.${n}`),l=r.forwardRef((o,d)=>{const{asChild:a,...i}=o,c=a?s:n;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),e.jsx(c,{...i,ref:d})});return l.displayName=`Primitive.${n}`,{...t,[n]:l}},{}),on=[" ","Enter","ArrowUp","ArrowDown"],ln=[" ","Enter"],re="Select",[Ne,ye,cn]=ss(re),[de]=Js(re,[cn,tt]),Se=tt(),[dn,Q]=de(re),[mn,un]=de(re),pt=t=>{const{__scopeSelect:n,children:s,open:l,defaultOpen:o,onOpenChange:d,value:a,defaultValue:i,onValueChange:c,dir:m,name:p,autoComplete:x,disabled:j,required:S,form:N}=t,u=Se(n),[g,w]=r.useState(null),[h,y]=r.useState(null),[A,_]=r.useState(!1),te=ys(m),[R,O]=He({prop:l,defaultProp:o??!1,onChange:d,caller:re}),[v,U]=He({prop:a,defaultProp:i,onChange:c,caller:re}),I=r.useRef(null),F=g?N||!!g.closest("form"):!0,[K,$]=r.useState(new Set),W=Array.from(K).map(D=>D.props.value).join(";");return e.jsx(ms,{...u,children:e.jsxs(dn,{required:S,scope:n,trigger:g,onTriggerChange:w,valueNode:h,onValueNodeChange:y,valueNodeHasChildren:A,onValueNodeHasChildrenChange:_,contentId:Ue(),value:v,onValueChange:U,open:R,onOpenChange:O,dir:te,triggerPointerDownPosRef:I,disabled:j,children:[e.jsx(Ne.Provider,{scope:n,children:e.jsx(mn,{scope:t.__scopeSelect,onNativeOptionAdd:r.useCallback(D=>{$(V=>new Set(V).add(D))},[]),onNativeOptionRemove:r.useCallback(D=>{$(V=>{const z=new Set(V);return z.delete(D),z})},[]),children:s})}),F?e.jsxs(Ot,{"aria-hidden":!0,required:S,tabIndex:-1,name:p,autoComplete:x,value:v,onChange:D=>U(D.target.value),disabled:j,form:N,children:[v===void 0?e.jsx("option",{value:""}):null,Array.from(K)]},W):null]})})};pt.displayName=re;var xt="SelectTrigger",ht=r.forwardRef((t,n)=>{const{__scopeSelect:s,disabled:l=!1,...o}=t,d=Se(s),a=Q(xt,s),i=a.disabled||l,c=H(n,a.onTriggerChange),m=ye(s),p=r.useRef("touch"),[x,j,S]=Bt(u=>{const g=m().filter(y=>!y.disabled),w=g.find(y=>y.value===a.value),h=Vt(g,u,w);h!==void 0&&a.onValueChange(h.value)}),N=u=>{i||(a.onOpenChange(!0),S()),u&&(a.triggerPointerDownPosRef.current={x:Math.round(u.pageX),y:Math.round(u.pageY)})};return e.jsx(us,{asChild:!0,...d,children:e.jsx(L.button,{type:"button",role:"combobox","aria-controls":a.contentId,"aria-expanded":a.open,"aria-required":a.required,"aria-autocomplete":"none",dir:a.dir,"data-state":a.open?"open":"closed",disabled:i,"data-disabled":i?"":void 0,"data-placeholder":Ut(a.value)?"":void 0,...o,ref:c,onClick:E(o.onClick,u=>{u.currentTarget.focus(),p.current!=="mouse"&&N(u)}),onPointerDown:E(o.onPointerDown,u=>{p.current=u.pointerType;const g=u.target;g.hasPointerCapture(u.pointerId)&&g.releasePointerCapture(u.pointerId),u.button===0&&u.ctrlKey===!1&&u.pointerType==="mouse"&&(N(u),u.preventDefault())}),onKeyDown:E(o.onKeyDown,u=>{const g=x.current!=="";!(u.ctrlKey||u.altKey||u.metaKey)&&u.key.length===1&&j(u.key),!(g&&u.key===" ")&&on.includes(u.key)&&(N(),u.preventDefault())})})})});ht.displayName=xt;var ft="SelectValue",gt=r.forwardRef((t,n)=>{const{__scopeSelect:s,className:l,style:o,children:d,placeholder:a="",...i}=t,c=Q(ft,s),{onValueNodeHasChildrenChange:m}=c,p=d!==void 0,x=H(n,c.onValueNodeChange);return X(()=>{m(p)},[m,p]),e.jsx(L.span,{...i,ref:x,style:{pointerEvents:"none"},children:Ut(c.value)?e.jsx(e.Fragment,{children:a}):d})});gt.displayName=ft;var pn="SelectIcon",vt=r.forwardRef((t,n)=>{const{__scopeSelect:s,children:l,...o}=t;return e.jsx(L.span,{"aria-hidden":!0,...o,ref:n,children:l||"▼"})});vt.displayName=pn;var xn="SelectPortal",jt=t=>e.jsx(rs,{asChild:!0,...t});jt.displayName=xn;var ae="SelectContent",Nt=r.forwardRef((t,n)=>{const s=Q(ae,t.__scopeSelect),[l,o]=r.useState();if(X(()=>{o(new DocumentFragment)},[]),!s.open){const d=l;return d?Ye.createPortal(e.jsx(yt,{scope:t.__scopeSelect,children:e.jsx(Ne.Slot,{scope:t.__scopeSelect,children:e.jsx("div",{children:t.children})})}),d):null}return e.jsx(St,{...t,ref:n})});Nt.displayName=ae;var B=10,[yt,ee]=de(ae),hn="SelectContentImpl",fn=ut("SelectContent.RemoveScroll"),St=r.forwardRef((t,n)=>{const{__scopeSelect:s,position:l="item-aligned",onCloseAutoFocus:o,onEscapeKeyDown:d,onPointerDownOutside:a,side:i,sideOffset:c,align:m,alignOffset:p,arrowPadding:x,collisionBoundary:j,collisionPadding:S,sticky:N,hideWhenDetached:u,avoidCollisions:g,...w}=t,h=Q(ae,s),[y,A]=r.useState(null),[_,te]=r.useState(null),R=H(n,f=>A(f)),[O,v]=r.useState(null),[U,I]=r.useState(null),F=ye(s),[K,$]=r.useState(!1),W=r.useRef(!1);r.useEffect(()=>{if(y)return Ss(y)},[y]),ws();const D=r.useCallback(f=>{const[T,...M]=F().map(P=>P.ref.current),[b]=M.slice(-1),C=document.activeElement;for(const P of f)if(P===C||(P?.scrollIntoView({block:"nearest"}),P===T&&_&&(_.scrollTop=0),P===b&&_&&(_.scrollTop=_.scrollHeight),P?.focus(),document.activeElement!==C))return},[F,_]),V=r.useCallback(()=>D([O,y]),[D,O,y]);r.useEffect(()=>{K&&V()},[K,V]);const{onOpenChange:z,triggerPointerDownPosRef:q}=h;r.useEffect(()=>{if(y){let f={x:0,y:0};const T=b=>{f={x:Math.abs(Math.round(b.pageX)-(q.current?.x??0)),y:Math.abs(Math.round(b.pageY)-(q.current?.y??0))}},M=b=>{f.x<=10&&f.y<=10?b.preventDefault():y.contains(b.target)||z(!1),document.removeEventListener("pointermove",T),q.current=null};return q.current!==null&&(document.addEventListener("pointermove",T),document.addEventListener("pointerup",M,{capture:!0,once:!0})),()=>{document.removeEventListener("pointermove",T),document.removeEventListener("pointerup",M,{capture:!0})}}},[y,z,q]),r.useEffect(()=>{const f=()=>z(!1);return window.addEventListener("blur",f),window.addEventListener("resize",f),()=>{window.removeEventListener("blur",f),window.removeEventListener("resize",f)}},[z]);const[we,he]=Bt(f=>{const T=F().filter(C=>!C.disabled),M=T.find(C=>C.ref.current===document.activeElement),b=Vt(T,f,M);b&&setTimeout(()=>b.ref.current.focus())}),be=r.useCallback((f,T,M)=>{const b=!W.current&&!M;(h.value!==void 0&&h.value===T||b)&&(v(f),b&&(W.current=!0))},[h.value]),Ce=r.useCallback(()=>y?.focus(),[y]),oe=r.useCallback((f,T,M)=>{const b=!W.current&&!M;(h.value!==void 0&&h.value===T||b)&&I(f)},[h.value]),fe=l==="popper"?Ae:wt,me=fe===Ae?{side:i,sideOffset:c,align:m,alignOffset:p,arrowPadding:x,collisionBoundary:j,collisionPadding:S,sticky:N,hideWhenDetached:u,avoidCollisions:g}:{};return e.jsx(yt,{scope:s,content:y,viewport:_,onViewportChange:te,itemRefCallback:be,selectedItem:O,onItemLeave:Ce,itemTextRefCallback:oe,focusSelectedItem:V,selectedItemText:U,position:l,isPositioned:K,searchRef:we,children:e.jsx(bs,{as:fn,allowPinchZoom:!0,children:e.jsx(Cs,{asChild:!0,trapped:h.open,onMountAutoFocus:f=>{f.preventDefault()},onUnmountAutoFocus:E(o,f=>{h.trigger?.focus({preventScroll:!0}),f.preventDefault()}),children:e.jsx(os,{asChild:!0,disableOutsidePointerEvents:!0,onEscapeKeyDown:d,onPointerDownOutside:a,onFocusOutside:f=>f.preventDefault(),onDismiss:()=>h.onOpenChange(!1),children:e.jsx(fe,{role:"listbox",id:h.contentId,"data-state":h.open?"open":"closed",dir:h.dir,onContextMenu:f=>f.preventDefault(),...w,...me,onPlaced:()=>$(!0),ref:R,style:{display:"flex",flexDirection:"column",outline:"none",...w.style},onKeyDown:E(w.onKeyDown,f=>{const T=f.ctrlKey||f.altKey||f.metaKey;if(f.key==="Tab"&&f.preventDefault(),!T&&f.key.length===1&&he(f.key),["ArrowUp","ArrowDown","Home","End"].includes(f.key)){let b=F().filter(C=>!C.disabled).map(C=>C.ref.current);if(["ArrowUp","End"].includes(f.key)&&(b=b.slice().reverse()),["ArrowUp","ArrowDown"].includes(f.key)){const C=f.target,P=b.indexOf(C);b=b.slice(P+1)}setTimeout(()=>D(b)),f.preventDefault()}})})})})})})});St.displayName=hn;var gn="SelectItemAlignedPosition",wt=r.forwardRef((t,n)=>{const{__scopeSelect:s,onPlaced:l,...o}=t,d=Q(ae,s),a=ee(ae,s),[i,c]=r.useState(null),[m,p]=r.useState(null),x=H(n,R=>p(R)),j=ye(s),S=r.useRef(!1),N=r.useRef(!0),{viewport:u,selectedItem:g,selectedItemText:w,focusSelectedItem:h}=a,y=r.useCallback(()=>{if(d.trigger&&d.valueNode&&i&&m&&u&&g&&w){const R=d.trigger.getBoundingClientRect(),O=m.getBoundingClientRect(),v=d.valueNode.getBoundingClientRect(),U=w.getBoundingClientRect();if(d.dir!=="rtl"){const C=U.left-O.left,P=v.left-C,se=R.left-P,ne=R.width+se,Ie=Math.max(ne,O.width),Te=window.innerWidth-B,Pe=qe(P,[B,Math.max(B,Te-Ie)]);i.style.minWidth=ne+"px",i.style.left=Pe+"px"}else{const C=O.right-U.right,P=window.innerWidth-v.right-C,se=window.innerWidth-R.right-P,ne=R.width+se,Ie=Math.max(ne,O.width),Te=window.innerWidth-B,Pe=qe(P,[B,Math.max(B,Te-Ie)]);i.style.minWidth=ne+"px",i.style.right=Pe+"px"}const I=j(),F=window.innerHeight-B*2,K=u.scrollHeight,$=window.getComputedStyle(m),W=parseInt($.borderTopWidth,10),D=parseInt($.paddingTop,10),V=parseInt($.borderBottomWidth,10),z=parseInt($.paddingBottom,10),q=W+D+K+z+V,we=Math.min(g.offsetHeight*5,q),he=window.getComputedStyle(u),be=parseInt(he.paddingTop,10),Ce=parseInt(he.paddingBottom,10),oe=R.top+R.height/2-B,fe=F-oe,me=g.offsetHeight/2,f=g.offsetTop+me,T=W+D+f,M=q-T;if(T<=oe){const C=I.length>0&&g===I[I.length-1].ref.current;i.style.bottom="0px";const P=m.clientHeight-u.offsetTop-u.offsetHeight,se=Math.max(fe,me+(C?Ce:0)+P+V),ne=T+se;i.style.height=ne+"px"}else{const C=I.length>0&&g===I[0].ref.current;i.style.top="0px";const se=Math.max(oe,W+u.offsetTop+(C?be:0)+me)+M;i.style.height=se+"px",u.scrollTop=T-oe+u.offsetTop}i.style.margin=`${B}px 0`,i.style.minHeight=we+"px",i.style.maxHeight=F+"px",l?.(),requestAnimationFrame(()=>S.current=!0)}},[j,d.trigger,d.valueNode,i,m,u,g,w,d.dir,l]);X(()=>y(),[y]);const[A,_]=r.useState();X(()=>{m&&_(window.getComputedStyle(m).zIndex)},[m]);const te=r.useCallback(R=>{R&&N.current===!0&&(y(),h?.(),N.current=!1)},[y,h]);return e.jsx(jn,{scope:s,contentWrapper:i,shouldExpandOnScrollRef:S,onScrollButtonChange:te,children:e.jsx("div",{ref:c,style:{display:"flex",flexDirection:"column",position:"fixed",zIndex:A},children:e.jsx(L.div,{...o,ref:x,style:{boxSizing:"border-box",maxHeight:"100%",...o.style}})})})});wt.displayName=gn;var vn="SelectPopperPosition",Ae=r.forwardRef((t,n)=>{const{__scopeSelect:s,align:l="start",collisionPadding:o=B,...d}=t,a=Se(s);return e.jsx(ps,{...a,...d,ref:n,align:l,collisionPadding:o,style:{boxSizing:"border-box",...d.style,"--radix-select-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-select-content-available-width":"var(--radix-popper-available-width)","--radix-select-content-available-height":"var(--radix-popper-available-height)","--radix-select-trigger-width":"var(--radix-popper-anchor-width)","--radix-select-trigger-height":"var(--radix-popper-anchor-height)"}})});Ae.displayName=vn;var[jn,Ve]=de(ae,{}),De="SelectViewport",bt=r.forwardRef((t,n)=>{const{__scopeSelect:s,nonce:l,...o}=t,d=ee(De,s),a=Ve(De,s),i=H(n,d.onViewportChange),c=r.useRef(0);return e.jsxs(e.Fragment,{children:[e.jsx("style",{dangerouslySetInnerHTML:{__html:"[data-radix-select-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-select-viewport]::-webkit-scrollbar{display:none}"},nonce:l}),e.jsx(Ne.Slot,{scope:s,children:e.jsx(L.div,{"data-radix-select-viewport":"",role:"presentation",...o,ref:i,style:{position:"relative",flex:1,overflow:"hidden auto",...o.style},onScroll:E(o.onScroll,m=>{const p=m.currentTarget,{contentWrapper:x,shouldExpandOnScrollRef:j}=a;if(j?.current&&x){const S=Math.abs(c.current-p.scrollTop);if(S>0){const N=window.innerHeight-B*2,u=parseFloat(x.style.minHeight),g=parseFloat(x.style.height),w=Math.max(u,g);if(w<N){const h=w+S,y=Math.min(N,h),A=h-y;x.style.height=y+"px",x.style.bottom==="0px"&&(p.scrollTop=A>0?A:0,x.style.justifyContent="flex-end")}}}c.current=p.scrollTop})})})]})});bt.displayName=De;var Ct="SelectGroup",[Nn,yn]=de(Ct),Sn=r.forwardRef((t,n)=>{const{__scopeSelect:s,...l}=t,o=Ue();return e.jsx(Nn,{scope:s,id:o,children:e.jsx(L.div,{role:"group","aria-labelledby":o,...l,ref:n})})});Sn.displayName=Ct;var It="SelectLabel",Tt=r.forwardRef((t,n)=>{const{__scopeSelect:s,...l}=t,o=yn(It,s);return e.jsx(L.div,{id:o.id,...l,ref:n})});Tt.displayName=It;var je="SelectItem",[wn,Pt]=de(je),Et=r.forwardRef((t,n)=>{const{__scopeSelect:s,value:l,disabled:o=!1,textValue:d,...a}=t,i=Q(je,s),c=ee(je,s),m=i.value===l,[p,x]=r.useState(d??""),[j,S]=r.useState(!1),N=H(n,h=>c.itemRefCallback?.(h,l,o)),u=Ue(),g=r.useRef("touch"),w=()=>{o||(i.onValueChange(l),i.onOpenChange(!1))};if(l==="")throw new Error("A <Select.Item /> must have a value prop that is not an empty string. This is because the Select value can be set to an empty string to clear the selection and show the placeholder.");return e.jsx(wn,{scope:s,value:l,disabled:o,textId:u,isSelected:m,onItemTextChange:r.useCallback(h=>{x(y=>y||(h?.textContent??"").trim())},[]),children:e.jsx(Ne.ItemSlot,{scope:s,value:l,disabled:o,textValue:p,children:e.jsx(L.div,{role:"option","aria-labelledby":u,"data-highlighted":j?"":void 0,"aria-selected":m&&j,"data-state":m?"checked":"unchecked","aria-disabled":o||void 0,"data-disabled":o?"":void 0,tabIndex:o?void 0:-1,...a,ref:N,onFocus:E(a.onFocus,()=>S(!0)),onBlur:E(a.onBlur,()=>S(!1)),onClick:E(a.onClick,()=>{g.current!=="mouse"&&w()}),onPointerUp:E(a.onPointerUp,()=>{g.current==="mouse"&&w()}),onPointerDown:E(a.onPointerDown,h=>{g.current=h.pointerType}),onPointerMove:E(a.onPointerMove,h=>{g.current=h.pointerType,o?c.onItemLeave?.():g.current==="mouse"&&h.currentTarget.focus({preventScroll:!0})}),onPointerLeave:E(a.onPointerLeave,h=>{h.currentTarget===document.activeElement&&c.onItemLeave?.()}),onKeyDown:E(a.onKeyDown,h=>{c.searchRef?.current!==""&&h.key===" "||(ln.includes(h.key)&&w(),h.key===" "&&h.preventDefault())})})})})});Et.displayName=je;var ue="SelectItemText",Rt=r.forwardRef((t,n)=>{const{__scopeSelect:s,className:l,style:o,...d}=t,a=Q(ue,s),i=ee(ue,s),c=Pt(ue,s),m=un(ue,s),[p,x]=r.useState(null),j=H(n,w=>x(w),c.onItemTextChange,w=>i.itemTextRefCallback?.(w,c.value,c.disabled)),S=p?.textContent,N=r.useMemo(()=>e.jsx("option",{value:c.value,disabled:c.disabled,children:S},c.value),[c.disabled,c.value,S]),{onNativeOptionAdd:u,onNativeOptionRemove:g}=m;return X(()=>(u(N),()=>g(N)),[u,g,N]),e.jsxs(e.Fragment,{children:[e.jsx(L.span,{id:c.textId,...d,ref:j}),c.isSelected&&a.valueNode&&!a.valueNodeHasChildren?Ye.createPortal(d.children,a.valueNode):null]})});Rt.displayName=ue;var _t="SelectItemIndicator",At=r.forwardRef((t,n)=>{const{__scopeSelect:s,...l}=t;return Pt(_t,s).isSelected?e.jsx(L.span,{"aria-hidden":!0,...l,ref:n}):null});At.displayName=_t;var Me="SelectScrollUpButton",Dt=r.forwardRef((t,n)=>{const s=ee(Me,t.__scopeSelect),l=Ve(Me,t.__scopeSelect),[o,d]=r.useState(!1),a=H(n,l.onScrollButtonChange);return X(()=>{if(s.viewport&&s.isPositioned){let i=function(){const m=c.scrollTop>0;d(m)};const c=s.viewport;return i(),c.addEventListener("scroll",i),()=>c.removeEventListener("scroll",i)}},[s.viewport,s.isPositioned]),o?e.jsx(kt,{...t,ref:a,onAutoScroll:()=>{const{viewport:i,selectedItem:c}=s;i&&c&&(i.scrollTop=i.scrollTop-c.offsetHeight)}}):null});Dt.displayName=Me;var ke="SelectScrollDownButton",Mt=r.forwardRef((t,n)=>{const s=ee(ke,t.__scopeSelect),l=Ve(ke,t.__scopeSelect),[o,d]=r.useState(!1),a=H(n,l.onScrollButtonChange);return X(()=>{if(s.viewport&&s.isPositioned){let i=function(){const m=c.scrollHeight-c.clientHeight,p=Math.ceil(c.scrollTop)<m;d(p)};const c=s.viewport;return i(),c.addEventListener("scroll",i),()=>c.removeEventListener("scroll",i)}},[s.viewport,s.isPositioned]),o?e.jsx(kt,{...t,ref:a,onAutoScroll:()=>{const{viewport:i,selectedItem:c}=s;i&&c&&(i.scrollTop=i.scrollTop+c.offsetHeight)}}):null});Mt.displayName=ke;var kt=r.forwardRef((t,n)=>{const{__scopeSelect:s,onAutoScroll:l,...o}=t,d=ee("SelectScrollButton",s),a=r.useRef(null),i=ye(s),c=r.useCallback(()=>{a.current!==null&&(window.clearInterval(a.current),a.current=null)},[]);return r.useEffect(()=>()=>c(),[c]),X(()=>{i().find(p=>p.ref.current===document.activeElement)?.ref.current?.scrollIntoView({block:"nearest"})},[i]),e.jsx(L.div,{"aria-hidden":!0,...o,ref:n,style:{flexShrink:0,...o.style},onPointerDown:E(o.onPointerDown,()=>{a.current===null&&(a.current=window.setInterval(l,50))}),onPointerMove:E(o.onPointerMove,()=>{d.onItemLeave?.(),a.current===null&&(a.current=window.setInterval(l,50))}),onPointerLeave:E(o.onPointerLeave,()=>{c()})})}),bn="SelectSeparator",Lt=r.forwardRef((t,n)=>{const{__scopeSelect:s,...l}=t;return e.jsx(L.div,{"aria-hidden":!0,...l,ref:n})});Lt.displayName=bn;var Le="SelectArrow",Cn=r.forwardRef((t,n)=>{const{__scopeSelect:s,...l}=t,o=Se(s),d=Q(Le,s),a=ee(Le,s);return d.open&&a.position==="popper"?e.jsx(xs,{...o,...l,ref:n}):null});Cn.displayName=Le;var In="SelectBubbleInput",Ot=r.forwardRef(({__scopeSelect:t,value:n,...s},l)=>{const o=r.useRef(null),d=H(l,o),a=ds(n);return r.useEffect(()=>{const i=o.current;if(!i)return;const c=window.HTMLSelectElement.prototype,p=Object.getOwnPropertyDescriptor(c,"value").set;if(a!==n&&p){const x=new Event("change",{bubbles:!0});p.call(i,n),i.dispatchEvent(x)}},[a,n]),e.jsx(L.select,{...s,style:{...ns,...s.style},ref:d,defaultValue:n})});Ot.displayName=In;function Ut(t){return t===""||t===void 0}function Bt(t){const n=as(t),s=r.useRef(""),l=r.useRef(0),o=r.useCallback(a=>{const i=s.current+a;n(i),(function c(m){s.current=m,window.clearTimeout(l.current),m!==""&&(l.current=window.setTimeout(()=>c(""),1e3))})(i)},[n]),d=r.useCallback(()=>{s.current="",window.clearTimeout(l.current)},[]);return r.useEffect(()=>()=>window.clearTimeout(l.current),[]),[s,o,d]}function Vt(t,n,s){const o=n.length>1&&Array.from(n).every(m=>m===n[0])?n[0]:n,d=s?t.indexOf(s):-1;let a=Tn(t,Math.max(d,0));o.length===1&&(a=a.filter(m=>m!==s));const c=a.find(m=>m.textValue.toLowerCase().startsWith(o.toLowerCase()));return c!==s?c:void 0}function Tn(t,n){return t.map((s,l)=>t[(n+l)%t.length])}var Pn=pt,Ht=ht,En=gt,Rn=vt,_n=jt,Ft=Nt,An=bt,$t=Tt,Wt=Et,Dn=Rt,Mn=At,zt=Dt,Gt=Mt,Kt=Lt;const kn=Pn,Ln=En,qt=r.forwardRef(({className:t,children:n,...s},l)=>e.jsxs(Ht,{ref:l,className:G("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1 transition-transform duration-150 ease-in-out active:scale-98",t),...s,children:[n,e.jsx(Rn,{asChild:!0,children:e.jsx(nt,{className:"h-4 w-4 opacity-50"})})]}));qt.displayName=Ht.displayName;const Yt=r.forwardRef(({className:t,...n},s)=>e.jsx(zt,{ref:s,className:G("flex cursor-default items-center justify-center py-1",t),...n,children:e.jsx(gs,{className:"h-4 w-4"})}));Yt.displayName=zt.displayName;const Zt=r.forwardRef(({className:t,...n},s)=>e.jsx(Gt,{ref:s,className:G("flex cursor-default items-center justify-center py-1",t),...n,children:e.jsx(nt,{className:"h-4 w-4"})}));Zt.displayName=Gt.displayName;const Xt=r.forwardRef(({className:t,children:n,position:s="popper",...l},o)=>e.jsx(_n,{children:e.jsxs(Ft,{ref:o,className:G("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",s==="popper"&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",t),position:s,...l,children:[e.jsx(Yt,{}),e.jsx(An,{className:G("p-1",s==="popper"&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:n}),e.jsx(Zt,{})]})}));Xt.displayName=Ft.displayName;const On=r.forwardRef(({className:t,...n},s)=>e.jsx($t,{ref:s,className:G("py-1.5 pl-8 pr-2 text-sm font-semibold",t),...n}));On.displayName=$t.displayName;const ge=r.forwardRef(({className:t,children:n,...s},l)=>e.jsxs(Wt,{ref:l,className:G("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 transition-transform duration-150 ease-in-out active:scale-95",t),...s,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(Mn,{children:e.jsx(Ts,{className:"h-4 w-4"})})}),e.jsx(Dn,{children:n})]}));ge.displayName=Wt.displayName;const Un=r.forwardRef(({className:t,...n},s)=>e.jsx(Kt,{ref:s,className:G("-mx-1 my-1 h-px bg-muted",t),...n}));Un.displayName=Kt.displayName;function Bn({user:t,open:n,onOpenChange:s,onSuccess:l}){const[o,d]=r.useState(!1),[a,i]=r.useState({username:"",email:"",role:"user"}),{toast:c}=Oe();r.useEffect(()=>{t&&i({username:t.name,email:t.email,role:t.role==="管理员"?"admin":"user"})},[t]);const m=async p=>{if(p.preventDefault(),!!t){d(!0);try{const j=await(await fetch("/api/admin/users",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:t.id,...a})})).json();j.success?(c({title:"更新成功",description:"用户信息已更新"}),l(),s(!1)):c({title:"更新失败",description:j.error,variant:"destructive"})}catch{c({title:"更新失败",description:"网络错误，请稍后重试",variant:"destructive"})}finally{d(!1)}}};return e.jsx(at,{open:n,onOpenChange:s,children:e.jsxs(ot,{children:[e.jsxs(lt,{children:[e.jsx(it,{children:"编辑用户"}),e.jsx(ct,{children:"修改用户的基本信息和权限"})]}),e.jsxs("form",{onSubmit:m,children:[e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(ce,{htmlFor:"username",children:"用户名"}),e.jsx(Ee,{id:"username",value:a.username,onChange:p=>i({...a,username:p.target.value}),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(ce,{htmlFor:"email",children:"邮箱"}),e.jsx(Ee,{id:"email",type:"email",value:a.email,onChange:p=>i({...a,email:p.target.value}),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(ce,{children:"角色"}),e.jsx(Ps,{value:a.role,onValueChange:p=>i({...a,role:p}),children:e.jsxs(Es,{className:"grid w-full grid-cols-2",children:[e.jsx($e,{value:"user",children:"普通用户"}),e.jsx($e,{value:"admin",children:"管理员"})]})})]})]}),e.jsxs(Is,{children:[e.jsx(k,{type:"button",variant:"outline",onClick:()=>s(!1),disabled:o,children:"取消"}),e.jsxs(k,{type:"submit",disabled:o,children:[o&&e.jsx(Be,{className:"mr-2 h-4 w-4 animate-spin"}),"保存"]})]})]})]})})}function Vn({user:t,open:n,onOpenChange:s}){if(!t)return null;const l=o=>{if(!o)return"从未活跃";try{return new Date(o).toLocaleString("zh-CN")}catch{return"无效日期"}};return e.jsx(at,{open:n,onOpenChange:s,children:e.jsxs(ot,{className:"max-w-2xl",children:[e.jsxs(lt,{children:[e.jsx(it,{children:"用户详情"}),e.jsx(ct,{children:"查看用户的详细信息"})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"h-16 w-16 rounded-full bg-primary/10 flex items-center justify-center",children:e.jsx(We,{className:"h-8 w-8 text-primary"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("h3",{className:"text-xl font-semibold",children:t.name}),e.jsx(ie,{variant:t.role==="管理员"?"default":"secondary",children:t.role}),t.status==="banned"&&e.jsx(ie,{className:"bg-red-500/10 text-red-500 border-red-500/20",children:"已封禁"})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(Rs,{className:"h-4 w-4"}),t.email]})]})]}),e.jsx(Qe,{}),e.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"text-sm font-medium",children:"账户信息"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(Re,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"text-muted-foreground",children:"注册时间："}),e.jsx("span",{children:t.joinDate})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(We,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"text-muted-foreground",children:"用户ID："}),e.jsx("span",{className:"font-mono text-xs",children:t.id})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(Re,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"text-muted-foreground",children:"最后活跃："}),e.jsx("span",{children:l(t.lastActiveAt)})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"text-sm font-medium",children:"使用统计"}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"p-3 rounded-lg bg-muted/50",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"对话数"}),e.jsx("span",{className:"text-lg font-semibold",children:t.conversationCount})]})}),e.jsx("div",{className:"p-3 rounded-lg bg-muted/50",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"消息数"}),e.jsx("span",{className:"text-lg font-semibold",children:t.messageCount})]})})]})]})]})]})]})})}function Hn({searchQuery:t,onSearchChange:n}){const[s,l]=r.useState([]),[o,d]=r.useState(!1),[a,i]=r.useState(1),[c,m]=r.useState(0),[p,x]=r.useState(0),[j,S]=r.useState("all"),[N,u]=r.useState(null),[g,w]=r.useState(!1),[h,y]=r.useState(!1),{toast:A}=Oe(),_=async()=>{d(!0);try{const v=new URLSearchParams({search:t,status:j,page:a.toString(),pageSize:"10"}),I=await(await fetch(`/api/admin/users?${v}`)).json();I.success?(l(I.data.users),m(I.data.total),x(I.data.totalPages)):A({title:"获取失败",description:I.error||"无法加载用户列表",variant:"destructive"})}catch(v){console.error("获取用户列表失败:",v),A({title:"获取失败",description:"网络错误，请稍后重试",variant:"destructive"})}finally{d(!1)}};r.useEffect(()=>{_()},[t,j,a]);const te=v=>{u(v),y(!0)},R=v=>{u(v),w(!0)},O=async v=>{if(confirm("确定要删除此用户吗？此操作无法撤销。"))try{const I=await(await fetch(`/api/admin/users?userId=${v}`,{method:"DELETE"})).json();I.success?(A({title:"删除成功",description:I.message}),_()):A({title:"删除失败",description:I.error,variant:"destructive"})}catch(U){console.error("删除用户失败:",U),A({title:"删除失败",description:"网络错误，请稍后重试",variant:"destructive"})}};return e.jsxs("div",{className:"space-y-6 animate-in fade-in-50 duration-300",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold mb-2",children:"用户管理"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["管理和监控所有用户账户 (共 ",c," 人)"]})]}),e.jsxs(k,{className:"gap-2",children:[e.jsx(rt,{className:"h-4 w-4"}),"导出用户"]})]}),e.jsx(Y,{children:e.jsx(Z,{className:"pt-6",children:e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(_s,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(Ee,{placeholder:"搜索用户名、邮箱...",value:t,onChange:v=>n(v.target.value),className:"pl-10"})]}),e.jsxs(kn,{value:j,onValueChange:S,children:[e.jsxs(qt,{className:"w-[180px]",children:[e.jsx(Vs,{className:"h-4 w-4 mr-2"}),e.jsx(Ln,{placeholder:"筛选角色"})]}),e.jsxs(Xt,{children:[e.jsx(ge,{value:"all",children:"全部用户"}),e.jsx(ge,{value:"user",children:"普通用户"}),e.jsx(ge,{value:"admin",children:"管理员"})]})]})]})})}),e.jsxs(Y,{children:[e.jsx(pe,{children:e.jsxs(xe,{className:"text-lg flex items-center gap-2",children:[e.jsx(le,{className:"h-5 w-5"}),"用户列表"]})}),e.jsx(Z,{children:o?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(Be,{className:"h-8 w-8 animate-spin text-muted-foreground"})}):s.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(le,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"暂无用户数据"})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"space-y-3",children:s.map(v=>e.jsxs("div",{className:"flex items-center justify-between p-4 rounded-lg border border-border/40 hover:bg-muted/50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"h-10 w-10 rounded-full bg-primary/10 flex items-center justify-center",children:e.jsx(le,{className:"h-5 w-5 text-primary"})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"font-medium",children:v.name}),e.jsx(ie,{variant:v.role==="管理员"?"default":"secondary",className:"text-xs",children:v.role})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:v.email}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["加入: ",v.joinDate," | 对话: ",v.conversationCount," | 消息: ",v.messageCount]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(k,{variant:"ghost",size:"icon",title:"查看详情",onClick:()=>te(v),children:e.jsx(As,{className:"h-4 w-4"})}),e.jsx(k,{variant:"ghost",size:"icon",title:"编辑",onClick:()=>R(v),children:e.jsx(Fs,{className:"h-4 w-4"})}),e.jsx(k,{variant:"ghost",size:"icon",title:"删除",className:"text-red-500 hover:text-red-600 hover:bg-red-500/10",onClick:()=>O(v.id),children:e.jsx(vs,{className:"h-4 w-4"})})]})]},v.id))}),p>1&&e.jsxs("div",{className:"flex items-center justify-between mt-6 pt-6 border-t",children:[e.jsxs("p",{className:"text-sm text-muted-foreground",children:["第 ",a," 页，共 ",p," 页"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(k,{variant:"outline",size:"sm",onClick:()=>i(v=>Math.max(1,v-1)),disabled:a===1,children:[e.jsx(js,{className:"h-4 w-4"}),"上一页"]}),e.jsxs(k,{variant:"outline",size:"sm",onClick:()=>i(v=>Math.min(p,v+1)),disabled:a===p,children:["下一页",e.jsx(Ns,{className:"h-4 w-4"})]})]})]})]})})]}),e.jsx(Bn,{user:N,open:g,onOpenChange:w,onSuccess:_}),e.jsx(Vn,{user:N,open:h,onOpenChange:y})]})}function Fn(){const t=ls(),{user:n,initialized:s}=is(),[l,o]=r.useState(!0),[d,a]=r.useState("overview");if(r.useEffect(()=>{(async()=>{if(s)try{if(!n){t({to:"/auth/login"});return}if(n.role!=="admin"){t({to:"/"});return}o(!1)}catch(m){console.error("管理员权限检查失败:",m),t({to:"/"})}})()},[t,n,s]),l)return e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsxs("div",{className:"flex flex-col items-center gap-4",children:[e.jsx(Be,{className:"h-8 w-8 animate-spin text-blue-600"}),e.jsx("p",{className:"text-gray-600",children:"验证管理员权限中..."})]})});const i=()=>{switch(d){case"overview":return e.jsx(Ke,{});case"users":return e.jsx(Hn,{});case"analytics":return e.jsx(Zs,{});case"system":return e.jsx(Xs,{});default:return e.jsx(Ke,{})}};return e.jsx("div",{className:"min-h-screen bg-gray-50",children:e.jsxs("div",{className:"flex",children:[e.jsx(Ks,{activeSection:d,onSectionChange:a}),e.jsx("main",{className:"flex-1 p-8",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-8",children:[e.jsx(Ze,{className:"h-8 w-8 text-blue-600"}),e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"管理后台"})]}),i()]})})]})})}function vr(){return e.jsx(Ds,{requireAdmin:!0,children:e.jsx(Fn,{})})}export{vr as component};
